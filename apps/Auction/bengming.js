import { plugin, verc, data, config } from '../../api/api.js';
import {
    existplayer,
    Read_player,
    exist_najie_thing,
    Read_najie,
    Write_najie,
    Add_najie_thing,
    Write_player,
    Read_equipment,
    Write_equipment,
    Add_ä¿®ä¸º,
    isNotNull
} from '../../model/xiuxian.js';
const ä¸‰é­‚ææ–™ = {
    // ä¸‰é­‚ææ–™
    "å¤ªåˆé­‚æ™¶": {
        æ”»å‡»: 1500000000,
        é˜²å¾¡: 500000000,
        è¡€é‡: 1000000000,
        æš´å‡»ç‡: 0.08,
        æè¿°: "å¼€å¤©è¾Ÿåœ°æ—¶æ®‹ç•™çš„å…ˆå¤©é­‚å…‰ï¼Œè•´å«æ··æ²Œåˆåˆ†æ—¶çš„é˜³å’Œä¹‹æ°”ï¼Œé•¶åµŒåå¯å”¤é†’å‰‘çµã€Œèƒå…‰ã€ä¹‹é­‚",
        å”¯ä¸€:true
    },
    "ä¹éœ„çµé«“": {
        æ”»å‡»: 2000000000,
        é˜²å¾¡: 200000000,
        è¡€é‡: 500000000,
        æš´å‡»ç‡: 0.15,
        æè¿°: "ä¹å¤©é›·äº‘ä¸­æ·¬ç‚¼åƒå¹´çš„çµé«“ï¼Œé•¶åµŒæ—¶ä¼šæœ‰ç”µå…‰æµè½¬ï¼Œå¯æ¿€å‘å‰‘çµã€Œçˆ½çµã€çš„æè‡´é”‹èŠ’",å”¯ä¸€:true
    },
    "å¹½å†¥æœˆéœ²": {
        æ”»å‡»: 1200000000,
        é˜²å¾¡: 800000000,
        è¡€é‡: 1500000000,
        æš´å‡»ç‡: 0.05,
        æè¿°: "é»„æ³‰å½¼å²¸æœˆåå‡ç»“çš„è‡³é˜´éœ²ç ï¼Œèƒ½ä½¿å‰‘çµã€Œå¹½ç²¾ã€è§‰é†’ï¼Œå‰‘èº«ç¼ ç»•èš€éª¨å¯’é›¾",å”¯ä¸€:true
    },
}
const ä¸ƒé­„ææ–™ = {
    
    "å¤©ç‹¼ç‰™ç ‚": {
        æ”»å‡»: 300000000,
        é˜²å¾¡: 1800000000,
        è¡€é‡: 1200000000,
        æš´å‡»ç‡: 0.02,
        æè¿°: "æ´ªè’å¤©ç‹¼é™¨è½åçŠ¬é½¿æ‰€åŒ–çš„é‡‘ç ‚ï¼Œé•¶åµŒåå‰‘çµã€Œå°¸ç‹—ã€è§‰é†’ï¼Œå‰‘é¸£å¦‚ç‹¼å•¸å¯éœ‡æ…‘å¿ƒç¥",å”¯ä¸€:true
    },
    "ç„æ­¦é“é³": {
        æ”»å‡»: 500000000,
        é˜²å¾¡: 1500000000,
        è¡€é‡: 2000000000,
        æš´å‡»ç‡: 0,
        æè¿°: "ç¥å…½ç„æ­¦è„±è½çš„èƒŒç”²é³ç‰‡ï¼Œå¯ä½¿å‰‘çµã€Œä¼çŸ¢ã€å›ºè‹¥é‡‘æ±¤ï¼Œå‰‘æ°”è‡ªæˆæŠ¤ä½“ç½¡ç½©",å”¯ä¸€:true
    },
    "å‡¤å‡°ç«ç¾½": {
        æ”»å‡»: 800000000,
        é˜²å¾¡: 1000000000,
        è¡€é‡: 1500000000,
        æš´å‡»ç‡: 0.05,
        æè¿°: "æ¶…æ§ƒå‡¤å‡°å°¾ç¾½æ®‹ç•™çš„ç«ç§ï¼Œé•¶åµŒæ—¶å‰‘èº«ä¼šæµ®ç°å‡¤å‡°çº¹è·¯ï¼Œæ¿€æ´»å‰‘çµã€Œé›€é˜´ã€ç”Ÿç”Ÿä¸æ¯ä¹‹åŠ›",å”¯ä¸€:true
    },
    "é¥•é¤®éª¨ç‰": {
        æ”»å‡»: 1000000000,
        é˜²å¾¡: 1200000000,
        è¡€é‡: 1000000000,
        æš´å‡»ç‡: 0.03,
        æè¿°: "å‡¶å…½é¥•é¤®å–‰é—´è½¯éª¨æ‰€åŒ–ï¼Œå‰‘çµã€Œåè´¼ã€è§‰é†’åå¯åå™¬æ•Œæ–¹çµæ°”åå“ºå‰‘ä¸»",å”¯ä¸€:true
    },
    "éº’éºŸè§’ç²‰": {
        æ”»å‡»: 600000000,
        é˜²å¾¡: 2000000000,
        è¡€é‡: 800000000,
        æš´å‡»ç‡: 0.01,
        æè¿°: "ç¥¥ç‘éº’éºŸæ–­è§’ç ”ç£¨çš„æ™¶ç²‰ï¼Œé•¶åµŒåå‰‘çµã€Œéæ¯’ã€å¯åŒ–è§£ä¸‡æ¯’ï¼Œå‰‘èº«æ³›å‡ºé’ç‰å…‰æ³½",å”¯ä¸€:true
    },
    "å»ºæœ¨å¿ƒå±‘": {
        æ”»å‡»: 400000000,
        é˜²å¾¡: 1600000000,
        è¡€é‡: 1800000000,
        æš´å‡»ç‡: 0,
        æè¿°: "ä¸Šå¤å»ºæœ¨æ ‘å¿ƒå‰¥è½çš„æœ¨å±‘ï¼Œä»¤å‰‘çµã€Œé™¤ç§½ã€æ‹¥æœ‰å‡€åŒ–ä¹‹èƒ½ï¼Œå‰‘æ°”æ‰€è¿‡ä¹‹å¤„æ±¡ç§½å°½é™¤",å”¯ä¸€:true
    },
    "é²²é¹ç»’ç¾½": {
        æ”»å‡»: 700000000,
        é˜²å¾¡: 1000000000,
        è¡€é‡: 1500000000,
        æš´å‡»ç‡: 0.04,
        æè¿°: "åŒ—å†¥é²²é¹ç¿¼å°–è„±è½çš„ç»’ç¾½ï¼Œé•¶åµŒåå‰‘çµã€Œè‡­è‚ºã€å¯ä½¿å‰‘é€Ÿå¦‚ç¬ç§»ï¼Œå‡ºå‰‘æ—¶ä¼´æœ‰é£é›·ä¹‹å£°",å”¯ä¸€:true
    }
};
const ä¿®å¤ææ–™ = {
    "é’å²šé«“": { 
        ä¿®å¤å€¼: 800, 
        æè¿°: "é’å²šå±±çµè„‰æ·±å¤„å‡ç»“çš„ç‰é«“ï¼Œè§¦ä¹‹ç”Ÿé›¾ï¼Œèƒ½æŸ”åŒ–å‰‘èº«å´©è£‚çš„æˆ¾æ°”ï¼Œä¿®è¡¥å‰‘ä½“3å°ºå†…çš„è£‚ç—•" 
    },
    "ç„æ°´ä¸": { 
        ä¿®å¤å€¼: 1200, 
        æè¿°: "å¹½å†¥å¯’æ½­ä¸­åƒå¹´æ°´ç²¾åçº³çš„çµä¸ï¼Œé‡å‰‘åˆ™åŒ–æ°´ï¼Œå¯æµ¸æ¶¦å‰‘éª¨å¼¥è¡¥ç£¨æŸï¼Œå°¤å…¶å–„ä¿®å› å¹²æ¶¸å¯¼è‡´çš„å‰‘ä½“æ¯æ§" 
    },
    "åŠ«ç«çº¢ç»’": { 
        ä¿®å¤å€¼: 2000, 
        æè¿°: "é›·åŠ«è¿‡åæ®‹ç•™åœ¨é™¨é“ä¸Šçš„ç«ç»’ï¼Œæ€§çƒˆè€Œä¸ç„šï¼Œèƒ½é‡é“¸å‰‘èº«ä¸Šè¢«å¤©é›·åŠˆå¼€çš„ç¼éš™ï¼Œè‡ªå¸¦é•‡é­‚ä¹‹æ•ˆ" 
    },
    "æœ¨çµèƒ¶": { 
        ä¿®å¤å€¼: 1500, 
        æè¿°: "å»ºæœ¨æ®‹æ ¹æ¸—å‡ºçš„ç¥ç€çŠ¶èƒ¶è´¨ï¼Œå†…è—ä¸‡åƒæœ¨çº¹ï¼Œå¯ç²˜åˆæ–­è£‚çš„å‰‘æŸ„ä¸å‰‘èº«ï¼Œä½¿çµæ°”æµæ·Œå¦‚åˆ" 
    },
    "æ˜Ÿå°˜ç ‚": { 
        ä¿®å¤å€¼: 3000, 
        æè¿°: "åŒ—æ–—ç¬¬ä¸ƒæ˜Ÿé™¨è½ååŒ–æˆçš„æ˜Ÿæ²™ï¼Œå¾®å…‰æµè½¬ï¼Œèƒ½å¡«è¡¥å‰‘ä½“å› ç©¿æ¢­è™šç©ºé€ æˆçš„ç©ºé—´è£‚ç—•ï¼Œå¤å…¶æœ¬æº" 
    }
};

const æ·¬ç‚¼ææ–™ = {
    "äº”è¡Œèšçµæ™¶": {
        æ·¬ç‚¼å€¼: 60000,
        æ”»å‡»åŠ æˆ: 2000000000, // 20äº¿
        é˜²å¾¡åŠ æˆ: 2000000000, // 20äº¿
        è¡€é‡åŠ æˆ: 2000000000, // 20äº¿
        äº”è¡Œ: 5000,
        é˜´é˜³: 0,
        æ—¶ç©º: 0,
        å› æœ: 0,
        ç”Ÿå‘½: 0,
        æè¿°: "çº¯äº”è¡Œä¹‹åŠ›å‡ç»“çš„æ™¶çŸ³ï¼Œä¸å«å…¶ä»–æ³•åˆ™æ‚è´¨ï¼Œæ·¬ç‚¼åå‰‘ä½“å¯å®Œç¾å¼•åŠ¨é‡‘æœ¨æ°´ç«åœŸäº”ç³»èƒ½é‡ï¼Œå¯¹äº”è¡Œæ³•æœ¯å¢å¹…æå¼º"
    },
    "é˜´é˜³ä¸¤æç ‚": {
        æ·¬ç‚¼å€¼: 60000,
        æ”»å‡»åŠ æˆ: 2000000000, // 20äº¿
        é˜²å¾¡åŠ æˆ: 2000000000, // 20äº¿
        è¡€é‡åŠ æˆ: 2000000000, // 20äº¿
        äº”è¡Œ: 0,
        é˜´é˜³: 5000,
        æ—¶ç©º: 0,
        å› æœ: 0,
        ç”Ÿå‘½: 0,
        æè¿°: "é˜³æä¹‹æ—¥ä¸é˜´æä¹‹æœˆäº¤æ›¿æ—¶å‡ç»“çš„ç ‚ç²’ï¼Œçº¯é˜´é˜³äºŒæ°”æ„æˆï¼Œå¯è®©å‰‘ä½“åœ¨æ­£è´Ÿèƒ½é‡é—´è‡ªç”±è½¬æ¢ï¼Œå¯¹é‚ªç¥Ÿä¸çµä½“ä¼¤å®³ç¿»å€"
    },
    "æ—¶ç©ºå‡æ»çŸ³": {
        æ·¬ç‚¼å€¼: 60000,
        æ”»å‡»åŠ æˆ: 2000000000, // 20äº¿
        é˜²å¾¡åŠ æˆ: 2000000000, // 20äº¿
        è¡€é‡åŠ æˆ: 2000000000, // 20äº¿
        äº”è¡Œ: 0,
        é˜´é˜³: 0,
        æ—¶ç©º: 5000,
        å› æœ: 0,
        ç”Ÿå‘½: 0,
        æè¿°: "æ—¶é—´æµé€Ÿä¸ºé›¶çš„ç‰¹æ®Šç©ºé—´ä¸­å½¢æˆçš„å¥‡çŸ³ï¼Œè•´å«çº¯ç²¹æ—¶ç©ºæ³•åˆ™ï¼Œæ·¬ç‚¼åå‰‘ä½“å¯å†»ç»“æ”»å‡»è½¨è¿¹ï¼Œä½¿å¯¹æ‰‹é¿æ— å¯é¿"
    },
    "å› æœçº ç¼ ä¸": {
        æ·¬ç‚¼å€¼: 60000,
        æ”»å‡»åŠ æˆ: 2000000000, // 20äº¿
        é˜²å¾¡åŠ æˆ: 2000000000, // 20äº¿
        è¡€é‡åŠ æˆ: 2000000000, // 20äº¿
        äº”è¡Œ: 0,
        é˜´é˜³: 0,
        æ—¶ç©º: 0,
        å› æœ: 5000,
        ç”Ÿå‘½: 0,
        æè¿°: "ç”±äº¿ä¸‡å› æœçº¿äº¤ç»‡è€Œæˆçš„çµä¸ï¼Œåªå«å› æœæ³•åˆ™ä¹‹åŠ›ï¼Œæ·¬ç‚¼åå‰‘ä½“å¯é”å®šç›®æ ‡å› æœï¼Œä¸€å‡»å¿…ä¸­å…¶å‘½é—¨"
    },
    "ç”Ÿå‘½æœ¬æºéœ²": {
        æ·¬ç‚¼å€¼: 60000,
        æ”»å‡»åŠ æˆ: 2000000000, // 20äº¿
        é˜²å¾¡åŠ æˆ: 2000000000, // 20äº¿
        è¡€é‡åŠ æˆ: 2000000000, // 20äº¿
        äº”è¡Œ: 0,
        é˜´é˜³: 0,
        æ—¶ç©º: 0,
        å› æœ: 0,
        ç”Ÿå‘½: 5000,
        æè¿°: "ç”Ÿå‘½ä¹‹æ ‘æ ¹ç³»æ¸—å‡ºçš„æœ¬æºçµéœ²ï¼Œçº¯ç”Ÿå‘½èƒ½é‡æ„æˆï¼Œæ·¬ç‚¼åå‰‘ä½“å¯æ±²å–ä¸‡ç‰©ç”Ÿæœºï¼Œæ¯ä¸€æ¬¡æ”»å‡»éƒ½é™„å¸¦æ²»æ„ˆæ•ˆæœ"
    }
};
    
    
    
export class fenjue extends plugin {
    constructor() {
        super({
            name: 'æœ¬å‘½æ­¦å™¨',
            dsc: 'ä»å°ç”¨åˆ°å¤§',
            event: 'message',
            priority: 10,
            rule: [
                {
                    reg: '^#ç‚¼åŒ–æœ¬å‘½æ³•å®$',
                    fnc: 'jian'
                },
                {
                    reg: '^#(.*)ä¿®å¤çˆ±å‰‘$',
                    fnc: 'xiufu'
                },
                {
                    reg: '^#æ·¬ç‚¼å‰‘èº«(.*)$',
                    fnc: 'jianshen'
                },
                {
                    reg: '^#å‡åæœ¬å‘½å‰‘$',
                    fnc: 'shenghua'
                },
                {
                    reg: '^#å‰‘é­‚é•¶åµŒ(.*)$',
                    fnc: 'jianhun'
                },
                {
                    reg: '^#å‰‘é­„é•¶åµŒ(.*)$',
                    fnc: 'jianpo'
                },
                {
                    reg: '^#å¬å”¤å‰‘çµ$',
                    fnc: 'jianling'
                },
                {
                    reg: '^#ç£¨åˆå¿ƒæ€§$',
                    fnc: 'xinxin'
                },
                {
                    reg: '^#å‰‘å¢ƒå…±é¸£$',
                    fnc: 'jianjing'
                },
                {
                    reg: '^#åŒ–å‰‘ä¸ºé˜$', 
                    fnc: 'huaqiao'
                },
                {
                    reg: '^#åŒ–é˜ä¸ºå‰‘$', 
                    fnc: 'huajian'
                },
                {
                    reg: '^#å¼•é›·æ·¬ç«$', 
                    fnc: 'dujie'
                }
                

                
            ]
        });
       
    }
 async jian(e) {
         //ä¸å¼€æ”¾ç§èŠåŠŸèƒ½
         if (!e.isGroup) {
         return;
         }
         let usr_qq = e.user_id;
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
       
        let equipment = await Read_equipment(usr_qq);
  if(!isNotNull(equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("è¿™æŠŠå‰‘æ½œåŠ›ä¸è¡Œï¼Œå‚å‚è€çŸ£ï¼")}
  if(equipment.æ­¦å™¨.ç‚¼åŒ–å¯èƒ½ == 1){e.reply("è¿™æŠŠå‰‘ä¼¼ä¹å’Œä½ æ— ç¼˜")
    return false
  }
  let random = Math.random()
 if (random <= 0.7){e.reply("è¿™æŠŠå‰‘ä¼¼ä¹å’Œä½ æ— ç¼˜")
     equipment.æ­¦å™¨.ç‚¼åŒ–å¯èƒ½ = 1
    await Write_equipment(usr_qq, equipment);
    return false
 }else{
    e.reply("è¿™æŠŠå‰‘å¾ˆå¼ºï¼Œå¸Œæœ›ä½ å¥½å¥½çˆ±æŠ¤å®ƒï¼Œä½ ä»¬ä¼šæ˜¯æ±‚é“è·¯ä¸Šæœ€å¥½çš„æœ‹å‹")
    equipment.æ­¦å™¨.å‰‘å¢ƒ = "å‰‘èƒ"
    equipment.æ­¦å™¨.ç‚¼åŒ–å¯èƒ½ = 1
    await Write_equipment(usr_qq, equipment);
     return false
 }
}
async xiufu(e) {
         //ä¸å¼€æ”¾ç§èŠåŠŸèƒ½
         if (!e.isGroup) {
         return;
         }
         let usr_qq = e.user_id;
         const xiufuType = this.e.msg.replace("#ä¿®å¤çˆ±å‰‘","").trim();
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
    
        let equipment = await Read_equipment(usr_qq);
 if (!isNotNull (equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("ä½ è¿™å•¥æ½œåŠ›å•Šï¼Œè¿˜ä¿®å¤")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ == "å‡¡é“"){e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ")
    return false
 }
 if (!ä¿®å¤ææ–™[xiufuType]) {
            return this.reply("ä½ è¿™æ‹¿çš„å•¥å•Š");
        }
if (!await exist_najie_thing(usr_qq, xiufuType, "é“å…·")) {
            return this.reply(`ä½ å“ªæœ‰ã€${xiufuType}ã€‘å•Š`);
        }
        const ä¿®å¤æ•ˆæœ = ä¿®å¤ææ–™[xiufuType];
                
                
                if(equipment.æ­¦å™¨.è€ä¹…åº¦ + ä¿®å¤æ•ˆæœ.ä¿®å¤å€¼ > equipment.æ­¦å™¨.è€ä¹…ä¸Šé™){
                    equipment.æ­¦å™¨.è€ä¹…åº¦  = equipment.æ­¦å™¨.è€ä¹…ä¸Šé™}else{
                equipment.æ­¦å™¨.è€ä¹…åº¦ += ä¿®å¤æ•ˆæœ.ä¿®å¤å€¼;}
                let xiufubaifenbi = (equipment.æ­¦å™¨.è€ä¹…åº¦ / equipment.æ­¦å™¨.è€ä¹…ä¸Šé™)*100+ "%" 
                await Add_najie_thing(usr_qq, xiufuType,  "é“å…·",-1);
        
               await Write_equipment(usr_qq, equipment);
               await this.reply([
            `æˆåŠŸä½¿ç”¨ ${xiufuType}`,
            `ä¿®å¤: ${ä¿®å¤æ•ˆæœ.ä¿®å¤å€¼}`,
            `ä¿®å¤ç™¾åˆ†æ¯”ï¼š${xiufubaifenbi}`,
            `ç»§ç»­åŠ æ²¹å§ï¼`
        ].join("\n"));
        
      
await Write_equipment(usr_qq, equipment);
await Write_player(usr_qq, player);
    }

      async jianshen(e) {
            if (!e.isGroup) {
         return;
         }
         let usr_qq = e.user_id;
         const cuilianType = this.e.msg.replace("#æ·¬ç‚¼å‰‘èº«","").trim();
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
     
        let equipment = await Read_equipment(usr_qq);
   
 if (!isNotNull (equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("ä½ è¿™å•¥æ½œåŠ›å•Šï¼Œè¿˜ä¿®å¤")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ== "å‡¡é“"){e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ")
    return false
 }

            if (!await exist_najie_thing(usr_qq, cuilianType, "é“å…·")) {
                return this.reply(`ç¼ºå°‘ã€${cuilianType}ã€‘`);
            }
    
           
            const æ·¬ç‚¼æ•ˆæœ = æ·¬ç‚¼ææ–™[cuilianType];
            
            
            equipment.æ­¦å™¨.atk += æ·¬ç‚¼æ•ˆæœ.æ”»å‡»åŠ æˆ;
            player.æ”»å‡» += æ·¬ç‚¼æ•ˆæœ.æ”»å‡»åŠ æˆ;
            equipment.æ­¦å™¨.def += æ·¬ç‚¼æ•ˆæœ.é˜²å¾¡åŠ æˆ;
            player.é˜²å¾¡ += æ·¬ç‚¼æ•ˆæœ.é˜²å¾¡åŠ æˆ;
            equipment.æ­¦å™¨.HP += æ·¬ç‚¼æ•ˆæœ.è¡€é‡åŠ æˆ;
            player.è¡€é‡ä¸Šé™ += æ·¬ç‚¼æ•ˆæœ.è¡€é‡åŠ æˆ;
            equipment.æ­¦å™¨.æ·¬ç‚¼å€¼ += æ·¬ç‚¼æ•ˆæœ.æ·¬ç‚¼å€¼;
            equipment.æ­¦å™¨.äº”è¡Œ += æ·¬ç‚¼æ•ˆæœ.äº”è¡Œ;
            equipment.æ­¦å™¨.é˜´é˜³ += æ·¬ç‚¼æ•ˆæœ.é˜´é˜³;
            equipment.æ­¦å™¨.æ—¶ç©º  += æ·¬ç‚¼æ•ˆæœ.æ—¶ç©º ;
            equipment.æ­¦å™¨.å› æœ += æ·¬ç‚¼æ•ˆæœ.å› æœ;
            equipment.æ­¦å™¨.ç”Ÿå‘½ += æ·¬ç‚¼æ•ˆæœ.ç”Ÿå‘½;
            


            
    
            // ä¿å­˜æ•°æ®
            await Add_najie_thing(usr_qq, cuilianType,  "é“å…·",-1);
            await Write_player(usr_qq, player);
            await Write_equipment(player.id, equipment);
    const elements = [
          { type: 'äº”è¡Œ', val: equipment.æ­¦å™¨.äº”è¡Œ },
          { type: 'é˜´é˜³', val: equipment.æ­¦å™¨.é˜´é˜³ },
          { type: 'æ—¶ç©º', val: equipment.æ­¦å™¨.æ—¶ç©º },
          { type: 'å› æœ', val: equipment.æ­¦å™¨.å› æœ },
          { type: 'ç”Ÿå‘½', val: equipment.æ­¦å™¨.ç”Ÿå‘½ }
        ];
        elements.sort((a, b) => b.val - a.val);
        const mainElement = elements[0].type;
            await this.reply([
                `æˆåŠŸæ·¬ç‚¼ ${cuilianType}`,
                `ææ–™æè¿°: ${æ·¬ç‚¼æ•ˆæœ.æè¿°}`,
                `å½“å‰æ·¬ç‚¼å€¼: ${equipment.æ­¦å™¨.æ·¬ç‚¼å€¼}`,
                `å½“å‰å…ƒç´ å±æ€§ï¼š${mainElement}`
                ].join("\n"));
        }
 async shenghua(e) {
               if (!e.isGroup) {
         return;
         }
         let usr_qq = e.user_id;
        
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
     
        let equipment = await Read_equipment(usr_qq);
 if (!isNotNull (equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("ä½ è¿™å•¥æ½œåŠ›å•Šï¼Œè¿˜ä¿®å¤")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ == "å‡¡é“"){e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ")
    return false
 }
        const å½“å‰ç­‰çº§ = equipment.æ­¦å™¨.å‰‘å¢ƒ;
        const ä¸‹ä¸€ç­‰çº§ = this.getNextLevel(å½“å‰ç­‰çº§);
        
        if (ä¸‹ä¸€ç­‰çº§ === å½“å‰ç­‰çº§) {
            return this.reply("æ‚¨çš„å‰‘å·²ç»æ˜¯å½“ä¸–æ— åŒäº†ï¼");
        }

        const æ‰€éœ€æ·¬ç‚¼å€¼ = this.getRequiredFireSpirit(ä¸‹ä¸€ç­‰çº§);
        if (equipment.æ­¦å™¨.æ·¬ç‚¼å€¼ < æ‰€éœ€æ·¬ç‚¼å€¼) {
            return this.reply([
                "  å‡åæ¡ä»¶ä¸è¶³ ",
                `â”œâ”€ å½“å‰ç­‰çº§: ${å½“å‰ç­‰çº§}`,
                `â”œâ”€ ä¸‹ä¸€ç­‰çº§: ${ä¸‹ä¸€ç­‰çº§}`,
                `â”œâ”€ éœ€è¦æ·¬ç‚¼: ${æ‰€éœ€æ·¬ç‚¼å€¼ }`,
                `â””â”€ å½“å‰æ·¬ç‚¼: ${equipment.æ­¦å™¨.æ·¬ç‚¼å€¼||0}`
            ].join("\n"));
        }else {equipment.æ­¦å™¨.å‰‘å¢ƒ = ä¸‹ä¸€ç­‰çº§


        // å…¨å±æ€§æå‡
        const åŠ æˆå€æ•° = this.getUpgradeMultiplier(å½“å‰ç­‰çº§);
        const oldAtk = equipment.æ­¦å™¨.atk;
const oldDef = equipment.æ­¦å™¨.def;
const oldHp = equipment.æ­¦å™¨.HP;
 equipment.æ­¦å™¨.atk = Math.floor(oldAtk * åŠ æˆå€æ•°.æ”»å‡»);
    equipment.æ­¦å™¨.def = Math.floor(oldDef * åŠ æˆå€æ•°.é˜²å¾¡);
    equipment.æ­¦å™¨.HP = Math.floor(oldHp * åŠ æˆå€æ•°.ç”Ÿå‘½);
// è®¡ç®—å±æ€§å¢é‡
const atkDiff = equipment.æ­¦å™¨.atk - oldAtk;
const defDiff = equipment.æ­¦å™¨.def - oldDef;
const hpDiff = equipment.æ­¦å™¨.HP - oldHp;

// æ›´æ–°ç©å®¶å±æ€§
player.æ”»å‡» += atkDiff;
player.é˜²å¾¡ += defDiff;
player.è¡€é‡ä¸Šé™ += hpDiff;

await this.reply([
    `å‡åæˆåŠŸï¼`,
    `å½“å‰å‰‘å¢ƒ: ${equipment.æ­¦å™¨.å‰‘å¢ƒ}`,
    `æ”»å‡»åŠ›: +${atkDiff}`,
    `é˜²å¾¡åŠ›: +${defDiff}`,
    `ç”Ÿå‘½å€¼: +${hpDiff}`
].join("\n"));
        }
     await Write_player(usr_qq, player);
     await Write_equipment(usr_qq, equipment);
     }

  async jianhun(e) {
            if (!e.isGroup) {
         return;
         }
         const sanhunType = this.e.msg.replace("#å‰‘é­‚é•¶åµŒ","").trim();
         //æœ‰æ— è´¦å·
          let usr_qq = e.user_id;
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
       
      
        let equipment = await Read_equipment(usr_qq);
 if (!isNotNull (equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("ä½ è¿™å•¥æ½œåŠ›å•Šï¼Œè¿˜ä¿®å¤")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ=="å‡¡é“"){e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 2){e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°æœ‰å‰‘çµçš„é˜¶æ®µå§ï¼Ÿ")
    return false
 }
 if (!ä¸‰é­‚ææ–™[sanhunType]) {
    return this.reply("ä½ è¿™æ˜¯å•¥å•Š");
}
            if (!await exist_najie_thing(usr_qq, sanhunType, "é“å…·")) {
                return this.reply(`ç¼ºå°‘ã€${sanhunType}ã€‘`);
            }
        if (ä¸‰é­‚ææ–™[sanhunType].å”¯ä¸€ && 
            equipment.æ­¦å™¨.å‰‘çµ.ä¸‰é­‚.includes(sanhunType)) {
            await this.reply(`ã€${sanhunType}ã€‘æ¯ç§é­‚åªèƒ½æœ‰ä¸€ä¸ªï¼`);
            return;
        }
           
            const ä¸‰é­‚æ•ˆæœ = ä¸‰é­‚ææ–™[sanhunType];
            
            
            equipment.æ­¦å™¨.å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ +=  ä¸‰é­‚æ•ˆæœ.æ”»å‡»;
            player.æ”»å‡» +=  ä¸‰é­‚æ•ˆæœ.æ”»å‡»;
            equipment.æ­¦å™¨.å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ +=  ä¸‰é­‚æ•ˆæœ.é˜²å¾¡;
            player.é˜²å¾¡ +=  ä¸‰é­‚æ•ˆæœ.é˜²å¾¡;
            equipment.æ­¦å™¨.å‰‘çµ.è¡€é‡å±æ€§åŠ æˆ +=  ä¸‰é­‚æ•ˆæœ.è¡€é‡;
            player.è¡€é‡ä¸Šé™ +=  ä¸‰é­‚æ•ˆæœ.è¡€é‡;


            
    
            // ä¿å­˜æ•°æ®
            await Add_najie_thing(usr_qq, sanhunType,"é“å…·",-1);
            await Write_player(usr_qq, player);
            await Write_equipment(player.id, equipment);
    
            await this.reply([
                ` ${sanhunType}æˆåŠŸ`,
                ].join("\n"));
        }


         async jianpo(e) {
            if (!e.isGroup) {
         return;
         }
         let usr_qq = e.user_id;
         const qipoType = this.e.msg.replace("#é•¶åµŒä¸ƒé­„","").trim();
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
       
        let equipment = await Read_equipment(usr_qq);
 if (!isNotNull (equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("ä½ è¿™å•¥æ½œåŠ›å•Šï¼Œè¿˜ä¿®å¤")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ== "å‡¡é“"){e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 2){e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°æœ‰å‰‘çµçš„é˜¶æ®µå§ï¼Ÿ")
    return false
 }
 if (!ä¸ƒé­„ææ–™[qipoType]) {
    return this.reply("ä½ è¿™æ˜¯å•¥å•Š");
}
            if (!await exist_najie_thing(usr_qq, qipoType, "é“å…·")) {
                return this.reply(`ç¼ºå°‘ã€${qipoType}ã€‘`);
            }
    if (ä¸ƒé­„ææ–™[qipoType].å”¯ä¸€ && 
            equipment.æ­¦å™¨.å‰‘çµ.ä¸ƒé­„.includes(qipoType)) {
            await this.reply(`ã€${qipoType}ã€‘æ¯ç§é­‚åªèƒ½æœ‰ä¸€ä¸ªï¼`);
            return;
        }
           
            const ä¸ƒé­„æ•ˆæœ = ä¸ƒé­„ææ–™[qipoType];
            
            
           equipment.æ­¦å™¨.å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ +=  ä¸ƒé­„æ•ˆæœ.æ”»å‡»;
            player.æ”»å‡» +=  ä¸ƒé­„æ•ˆæœ.æ”»å‡»;
            equipment.æ­¦å™¨.å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ +=  ä¸ƒé­„æ•ˆæœ.é˜²å¾¡;
            player.é˜²å¾¡ += ä¸ƒé­„æ•ˆæœ.é˜²å¾¡;
            equipment.æ­¦å™¨.å‰‘çµ.è¡€é‡å±æ€§åŠ æˆ +=  ä¸ƒé­„æ•ˆæœ.è¡€é‡;
            player.è¡€é‡ä¸Šé™ +=  ä¸ƒé­„æ•ˆæœ.è¡€é‡;
await Add_najie_thing(usr_qq, qipoType,  "é“å…·",-1);
            await Write_player(usr_qq, player);
            await Write_equipment(player.id, equipment);
            await this.reply([
                `æˆåŠŸæ·¬ç‚¼ ${qipoType}`,
               
                ].join("\n"));
        }
  async jianling(e) {
         //ä¸å¼€æ”¾ç§èŠåŠŸèƒ½
         if (!e.isGroup) {
         return;
         }
         let usr_qq = e.user_id;
         //æœ‰æ— è´¦å·
         let ifexistplay = await existplayer(usr_qq);
         if (!ifexistplay) {
         return;
         }
         let player = await data.getData("player", usr_qq);
     
        let equipment = await Read_equipment(usr_qq);
 if (!isNotNull (equipment.æ­¦å™¨.å‰‘å¢ƒ)){e.reply("ä½ è¿™å•¥æ½œåŠ›å•Šï¼Œè¿˜ä¿®å¤")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ== "å‡¡é“"){e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 2){e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°æœ‰å‰‘çµçš„é˜¶æ®µå§ï¼Ÿ")
    return false
 }
 if (equipment.æ­¦å™¨.å‰‘çµ.ä¸‰é­‚.length !== 3) {
            return e.reply("ä¸‰é­‚å°šæœªå®Œå…¨æˆå‹ï¼");
        }
        if (equipment.æ­¦å™¨.å‰‘çµ.ä¸‰é­‚.length !== 7) {
            return e.reply("ä¸ƒé­„å°šæœªå®Œå…¨æˆå‹ï¼");
        }
    

    // å¤„ç†ç”¨æˆ·è¾“å…¥
    const msg = e.msg.trim();
// è®¾ç½®é»˜è®¤æ€§æ ¼
if (!equipment.æ­¦å™¨.å‰‘çµ.æ€§æ ¼) {
  const æ€§æ ¼åˆ—è¡¨ = [
  "å­¤å‚²", "å†·å†½", "ç‹‚æš´", "æ²‰é™",  
  "å—œè¡€", "å¿ è¯š", "æ¡€éªœ", "æ·¡æ¼ ",  
  "æ‚²æ‚¯", "é‚ªå¼‚", "è‚ƒæ€", "çµåŠ¨",  
  "æ²§æ¡‘", "ç‹‚å‚²", "å¯‚ç­", "å®ˆæŠ¤"  
];
  equipment.æ­¦å™¨.å‰‘çµ.æ€§æ ¼ = æ€§æ ¼åˆ—è¡¨[Math.floor(Math.random() * æ€§æ ¼åˆ—è¡¨.length)];
}// 1. å‘½åé˜¶æ®µ
    if (!equipment.æ­¦å™¨.å‰‘çµ.å§“å) {
        if (msg.startsWith("#å‰‘çµå‘½å ")) {
            const name = msg.replace("#å‰‘çµå‘½å ", "").trim();
            if (name.length > 10) {
                return e.reply("å‰‘çµåå­—å¤ªé•¿ï¼ˆæœ€å¤š10ä¸ªå­—ï¼‰");
            }
            equipment.æ­¦å™¨.å‰‘çµ.å§“å = name;
            await Write_equipment(usr_qq, equipment);
            return e.reply(`å‰‘çµåå­—è®¾å®šä¸ºã€${name}ã€‘ï¼Œæ¥ä¸‹æ¥è¯·ç”¨ #å‰‘çµæ€§åˆ« ç”·/å¥³ è®¾å®šæ€§åˆ«`);
        }
        return e.reply("è¯·å…ˆä¸ºå‰‘çµå‘½åï¼ŒæŒ‡ä»¤ï¼š#å‰‘çµå‘½å [åå­—]");
    }

    // 2. æ€§åˆ«è®¾å®š
    if (!equipment.æ­¦å™¨.å‰‘çµ.æ€§åˆ«) {
        if (msg.startsWith("#å‰‘çµæ€§åˆ« ")) {
            const gender = msg.replace("#å‰‘çµæ€§åˆ« ", "").trim();
            if (gender !== "ç”·" && gender !== "å¥³") {
                return e.reply("æ€§åˆ«åªèƒ½æ˜¯ ç”· æˆ– å¥³");
            }
            equipment.æ­¦å™¨.å‰‘çµ.æ€§åˆ« = gender;
            
            // æ ¹æ®æ€§åˆ«åˆå§‹åŠ æˆ
            equipment.æ­¦å™¨.å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ = gender === "ç”·" ? 50000000 : 30000000;
            equipment.æ­¦å™¨.å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ = gender === "å¥³" ? 50000000 : 30000000;
            
            await Write_equipment(usr_qq, equipment);
            return e.reply([
                `å‰‘çµæ€§åˆ«è®¾å®šä¸ºã€${gender}ã€‘`,
                `å› å‰‘çµå¤©æ€§ï¼š`,
                gender === "ç”·" ? "â™‚ é˜³åˆšä¹‹æ°”ä½¿æ”»å‡»+5000ä¸‡" : "â™€ é˜´æŸ”ä¹‹è´¨ä½¿é˜²å¾¡+5000ä¸‡",
                `å½“å‰å¥‘åˆåº¦ï¼š0/100ï¼ˆé€šè¿‡æˆ˜æ–—æå‡ï¼‰`
            ].join("\n"));
        }
        return e.reply("è¯·è®¾å®šå‰‘çµæ€§åˆ«ï¼ŒæŒ‡ä»¤ï¼š#å‰‘çµæ€§åˆ« ç”·/å¥³");
    }

    // 3. å‰‘çµåŸ¹å…»é˜¶æ®µ
    const å‰‘çµ = equipment.æ­¦å™¨.å‰‘çµ;
    
    // æ˜¾ç¤ºå‰‘çµé¢æ¿
    if (msg === "#å‰‘çµçŠ¶æ€") {
        const é­‚é­„è¿›åº¦ = `ä¸‰é­‚:${å‰‘çµ.ä¸‰é­‚.length}/3 ä¸ƒé­„:${å‰‘çµ.ä¸ƒé­„.length}/7`;
        const åŠ æˆæ€»å€¼ = `æ”»+${å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ} é˜²+${å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ} è¡€+${å‰‘çµ.è¡€é‡å±æ€§åŠ æˆ}`;
        
        return e.reply([
            `ã€${å‰‘çµ.å§“å}ã€‘${å‰‘çµ.æ€§åˆ«==="ç”·"?"â™‚":"â™€"} Lv.${å‰‘çµ.å½“å‰ç­‰çº§}`,
            `å¥‘åˆåº¦:${å‰‘çµ.å¥‘åˆåº¦}/1000ï¼ˆ${å‰‘çµ.é˜¶æ®µ}ï¼‰`,
            `é­‚é­„:${é­‚é­„è¿›åº¦}`,
            `åŠ æˆ:${åŠ æˆæ€»å€¼}`,
           
        ].join("\n"));
    }
  }
    // 4. åŸ¹å…»æŒ‡ä»¤
   async xinxin(e) {
    // åŸºç¡€æ£€æŸ¥
    if (!e.isGroup) return;
    let usr_qq = e.user_id;
    if (!await existplayer(usr_qq)) return;
    
    let player = await data.getData("player", usr_qq);
  

    let equipment = await Read_equipment(usr_qq);
    // æ­¦å™¨æ£€æŸ¥
    if (!isNotNull(equipment.æ­¦å™¨.å‰‘å¢ƒ)) {
        e.reply("ä½ è¿™å•¥æ½œåŠ›å•Š");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ == "å‡¡é“") {
        e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 2) {
        e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°èƒ½æœ‰å‰‘çµçš„é˜¶æ®µå§ï¼Ÿ");
        return false;
    }

    

    const å‰‘çµ = equipment.æ­¦å™¨.å‰‘çµ;
    
    // æ£€æŸ¥æ˜¯å¦å·²å‘½åå’Œè®¾å®šæ€§åˆ«
    if (!å‰‘çµ.å§“å) {
        return e.reply("è¯·å…ˆä¸ºå‰‘çµå‘½åï¼ŒæŒ‡ä»¤ï¼š#å‰‘çµå‘½å [åå­—]");
    }
    if (!å‰‘çµ.æ€§åˆ«) {
        return e.reply("è¯·è®¾å®šå‰‘çµæ€§åˆ«ï¼ŒæŒ‡ä»¤ï¼š#å‰‘çµæ€§åˆ« ç”·/å¥³");
    }

    // æ ¹æ®å‰‘å¢ƒæå‡åŸºç¡€å¥‘åˆåº¦å¢åŠ é‡
    const åŸºç¡€å¥‘åˆåº¦å¢åŠ  = equipment.æ­¦å™¨.å‰‘å¢ƒ * 2;
    
    // éšæœºäº‹ä»¶è¡¨ - æ ¹æ®å‰‘çµæ€§æ ¼å’Œå¿ƒæƒ…å½±å“æ¦‚ç‡
    const éšæœºäº‹ä»¶ = [
        {
            åç§°: "å‰‘èº«å¾®é¢¤",
            æè¿°: `${å‰‘çµ.å§“å}çš„å‰‘èº«å¾®å¾®é¢¤åŠ¨ï¼Œ${å‰‘çµ.æ€§åˆ«==="ç”·"?"ä»–":"å¥¹"}ä¼¼ä¹å¯¹ä½ æœ‰æ‰€å›åº”`,
            å¥‘åˆåº¦å¢åŠ : åŸºç¡€å¥‘åˆåº¦å¢åŠ ,
            å¿ƒæƒ…å˜åŒ–: 1,
            æ¦‚ç‡: 0.4
        },
        {
            åç§°: "å‰‘æ°”å…±é¸£",
            æè¿°: `ä½ æ„Ÿå—åˆ°${å‰‘çµ.å§“å}çš„å‰‘æ°”ä¸ä½ äº§ç”Ÿå…±é¸£ï¼Œ${å‰‘çµ.æ€§åˆ«==="ç”·"?"ä»–":"å¥¹"}æ­£åœ¨é€‚åº”ä½ çš„æ°”æ¯`,
            å¥‘åˆåº¦å¢åŠ : åŸºç¡€å¥‘åˆåº¦å¢åŠ  * 1.5,
            å¿ƒæƒ…å˜åŒ–: 2,
            æ¦‚ç‡: 0.3
        },
        {
            åç§°: "å‰‘å¿ƒç›¸é€š",
            æè¿°: `åˆ¹é‚£é—´ï¼Œä½ ä¸${å‰‘çµ.å§“å}å¿ƒæ„ç›¸é€šï¼Œ${å‰‘çµ.æ€§åˆ«==="ç”·"?"ä»–":"å¥¹"}çš„${å‰‘çµ.æ€§æ ¼}æ€§æ ¼è®©ä½ æ„Ÿåˆ°${å‰‘çµ.æ€§æ ¼==="å­¤å‚²"?"é«˜ä¸å¯æ”€":å‰‘çµ.æ€§æ ¼==="æ¸©é¡º"?"å¦‚æ²æ˜¥é£":å‰‘çµ.æ€§æ ¼==="ç‹‚æš´"?"çƒ­è¡€æ²¸è…¾":"å¹³é™å¦‚æ°´"}`,
            å¥‘åˆåº¦å¢åŠ : åŸºç¡€å¥‘åˆåº¦å¢åŠ  * 2,
            å¿ƒæƒ…å˜åŒ–: 3,
            æ¦‚ç‡: 0.2
        },
        {
            åç§°: "å‰‘é“é¡¿æ‚Ÿ",
            æè¿°: `${å‰‘çµ.å§“å}çªç„¶ç»½æ”¾è€€çœ¼å‰‘å…‰ï¼Œ${å‰‘çµ.æ€§åˆ«==="ç”·"?"ä»–":"å¥¹"}å¼•å¯¼ä½ è¿›å…¥é¡¿æ‚ŸçŠ¶æ€`,
            å¥‘åˆåº¦å¢åŠ : åŸºç¡€å¥‘åˆåº¦å¢åŠ  * 3,
            å¿ƒæƒ…å˜åŒ–: 5,
            é™„åŠ æ•ˆæœ: { æ”»å‡»: equipment.æ­¦å™¨.å‰‘å¢ƒ * 10000000 },
            æ¦‚ç‡: 0.08
        },
        {
            åç§°: "äººå‰‘åˆä¸€",
            æè¿°: `ä½ ä¸${å‰‘çµ.å§“å}è¾¾åˆ°å®Œç¾åè°ƒï¼Œä»¿ä½›${å‰‘çµ.æ€§åˆ«==="ç”·"?"ä»–":"å¥¹"}å°±æ˜¯ä½ èº«ä½“çš„å»¶ä¼¸`,
            å¥‘åˆåº¦å¢åŠ : åŸºç¡€å¥‘åˆåº¦å¢åŠ  * 5,
            å¿ƒæƒ…å˜åŒ–: 8,
            é™„åŠ æ•ˆæœ: { 
                æ”»å‡»: equipment.æ­¦å™¨.å‰‘å¢ƒ * 20000000,
                é˜²å¾¡: equipment.æ­¦å™¨.å‰‘å¢ƒ * 15000000 
            },
            æ¦‚ç‡: 0.02
        }
    ];

    // è®¡ç®—å®é™…æ¦‚ç‡ï¼ˆå—å¿ƒæƒ…å½±å“ï¼‰
    let å®é™…æ¦‚ç‡ = éšæœºäº‹ä»¶.map(äº‹ä»¶ => {
        let è°ƒæ•´æ¦‚ç‡ = äº‹ä»¶.æ¦‚ç‡;
        if (å‰‘çµ.å¿ƒæƒ… > 70) è°ƒæ•´æ¦‚ç‡ *= 1.5;
        if (å‰‘çµ.å¿ƒæƒ… < 30) è°ƒæ•´æ¦‚ç‡ *= 0.7;
        return è°ƒæ•´æ¦‚ç‡;
    });

    // å½’ä¸€åŒ–æ¦‚ç‡
    const æ€»æ¦‚ç‡ = å®é™…æ¦‚ç‡.reduce((a, b) => a + b, 0);
    å®é™…æ¦‚ç‡ = å®é™…æ¦‚ç‡.map(p => p / æ€»æ¦‚ç‡);

    // ç¡®å®šå‘ç”Ÿçš„äº‹ä»¶
    let random = Math.random();
    let ç´¯è®¡æ¦‚ç‡ = 0;
    let å‘ç”Ÿäº‹ä»¶ = null;

    for (let i = 0; i < éšæœºäº‹ä»¶.length; i++) {
        ç´¯è®¡æ¦‚ç‡ += å®é™…æ¦‚ç‡[i];
        if (random <= ç´¯è®¡æ¦‚ç‡) {
            å‘ç”Ÿäº‹ä»¶ = éšæœºäº‹ä»¶[i];
            break;
        }
    }

    // æ›´æ–°å¥‘åˆåº¦å’Œå¿ƒæƒ…
    const æ—§å¥‘åˆåº¦ = å‰‘çµ.å¥‘åˆåº¦;
    å‰‘çµ.å¥‘åˆåº¦ = Math.min(æ—§å¥‘åˆåº¦ + Math.floor(å‘ç”Ÿäº‹ä»¶.å¥‘åˆåº¦å¢åŠ ), 1000);
    å‰‘çµ.å¿ƒæƒ… = Math.min(100, å‰‘çµ.å¿ƒæƒ… + å‘ç”Ÿäº‹ä»¶.å¿ƒæƒ…å˜åŒ–);

    // æ£€æŸ¥é˜¶æ®µå˜åŒ–
    const é˜¶æ®µè¡¨ = [
  { 
    éœ€æ±‚: 0, 
    åç§°: "å½¢åŒé™Œè·¯", 
    æè¿°: "å‰‘æœªå¼€é”‹ï¼Œäººæœªè¯†å‰‘",
    åŠ æˆ: { æ”»å‡»: 0, é˜²å¾¡: 0, è¡€é‡: 0 }
  },
  { 
    éœ€æ±‚: 50, 
    åç§°: "å‰‘é¸£åˆå“", 
    æè¿°: "å‰‘æ„Ÿå…¶ä¸»ï¼Œå¾®å¾®éœ‡é¢¤",
    åŠ æˆ: { æ”»å‡»: 100000000, é˜²å¾¡: 50000000, è¡€é‡: 200000000 }
  },
  { 
    éœ€æ±‚: 100, 
    åç§°: "åˆè¯†å‰‘å¿ƒ", 
    æè¿°: "å‰‘æ„èŒåŠ¨ï¼Œå¦‚èŠ½ç ´åœŸ",
    åŠ æˆ: { æ”»å‡»: 500000000, é˜²å¾¡: 500000000, è¡€é‡: 1000000000 }
  },
  { 
    éœ€æ±‚: 200, 
    åç§°: "å‰‘æ°”å¦‚è™¹", 
    æè¿°: "å‰‘å…‰ä¹ç°ï¼Œé”‹èŠ’åˆéœ²",
    åŠ æˆ: { æ”»å‡»: 2000000000, é˜²å¾¡: 1000000000, è¡€é‡: 3000000000 }
  },
  { 
    éœ€æ±‚: 350, 
    åç§°: "å‰‘é­„è§‰é†’", 
    æè¿°: "å‰‘çµä½è¯­ï¼Œé­‚é­„å…±é¸£",
    åŠ æˆ: { æ”»å‡»: 5000000000, é˜²å¾¡: 3000000000, è¡€é‡: 6000000000 }
  },
  { 
    éœ€æ±‚: 500, 
    åç§°: "å¿ƒæ„ç›¸é€š", 
    æè¿°: "äººå‰‘ç›¸çŸ¥ï¼Œå¦‚è‡‚ä½¿æŒ‡",
    åŠ æˆ: { æ”»å‡»: 10000000000, é˜²å¾¡: 8000000000, è¡€é‡: 15000000000 }
  },
  { 
    éœ€æ±‚: 750, 
    åç§°: "å‰‘æ„åŒ–å½¢", 
    æè¿°: "å‰‘æ°”å‡å®ï¼Œå¹»åŒ–ä¸‡ç‰©",
    åŠ æˆ: { æ”»å‡»: 25000000000, é˜²å¾¡: 15000000000, è¡€é‡: 20000000000 }
  },
  { 
    éœ€æ±‚: 1000, 
    åç§°: "äººå‰‘åˆä¸€", 
    æè¿°: "èº«å³å‰‘ï¼Œå‰‘å³èº«",
    åŠ æˆ: { æ”»å‡»: 50000000000, é˜²å¾¡: 30000000000, è¡€é‡: 40000000000 }
  },
  { 
    éœ€æ±‚: 1500, 
    åç§°: "å‰‘æˆ‘ä¸¤å¿˜", 
    æè¿°: "æ— å‰‘æ— æˆ‘ï¼Œå”¯æœ‰é“å­˜",
    åŠ æˆ: { æ”»å‡»: 100000000000, é˜²å¾¡: 80000000000, è¡€é‡: 100000000000 }
  },
  { 
    éœ€æ±‚: 2500, 
    åç§°: "å¤©å‰‘ä¹‹å¢ƒ", 
    æè¿°: "ä¸€å‰‘å¼€å¤©ï¼Œä¸‡æ³•å½’ä¸€",
    åŠ æˆ: { æ”»å‡»: 300000000000, é˜²å¾¡: 200000000000, è¡€é‡: 300000000000 }
  },
  { 
    éœ€æ±‚: 5000, 
    åç§°: "æ— ä¸Šå‰‘é“", 
    æè¿°: "å‰‘å³å¤©é“ï¼Œä¸æœ½ä¸ç­",
    åŠ æˆ: { æ”»å‡»: 1000000000000, é˜²å¾¡: 1000000000000, è¡€é‡: 1500000000000 }
  }
];

    const æ—§é˜¶æ®µ = å‰‘çµ.é˜¶æ®µ;
    const æ–°é˜¶æ®µ = é˜¶æ®µè¡¨.reduce((acc, cur) => 
        å‰‘çµ.å¥‘åˆåº¦ >= cur.éœ€æ±‚ ? cur.åç§° : acc, "å½¢åŒé™Œè·¯");

    let å›å¤å†…å®¹ = [
        `ã€${å‰‘çµ.å§“å}çš„æˆé•¿ã€‘`,
        `ã€Œ${å‘ç”Ÿäº‹ä»¶.æè¿°}ã€`,
        `å¥‘åˆåº¦ +${Math.floor(å‘ç”Ÿäº‹ä»¶.å¥‘åˆåº¦å¢åŠ )} (${æ—§å¥‘åˆåº¦} â†’ ${å‰‘çµ.å¥‘åˆåº¦})`,
        `å¿ƒæƒ… ${å‰‘çµ.å¿ƒæƒ… - å‘ç”Ÿäº‹ä»¶.å¿ƒæƒ…å˜åŒ–} â†’ ${å‰‘çµ.å¿ƒæƒ…}`
    ];

    // å¤„ç†é˜¶æ®µçªç ´
    if (æ–°é˜¶æ®µ !== æ—§é˜¶æ®µ) {
        å‰‘çµ.é˜¶æ®µ = æ–°é˜¶æ®µ;
        const çªç ´å¥–åŠ± = é˜¶æ®µè¡¨.find(s => s.åç§° === æ–°é˜¶æ®µ).åŠ æˆ;
        
        å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ += çªç ´å¥–åŠ±.æ”»å‡»;
        å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ += çªç ´å¥–åŠ±.é˜²å¾¡;
        å‰‘çµ.è¡€é‡å±æ€§åŠ æˆ += çªç ´å¥–åŠ±.è¡€é‡;
        
        player.æ”»å‡» += çªç ´å¥–åŠ±.æ”»å‡»;
        player.é˜²å¾¡ += çªç ´å¥–åŠ±.é˜²å¾¡;
        player.è¡€é‡ä¸Šé™ += çªç ´å¥–åŠ±.è¡€é‡;

        å›å¤å†…å®¹.push(
            `âœ¨ ${å‰‘çµ.å§“å}çªç ´è‡³ã€${æ–°é˜¶æ®µ}ã€‘ï¼`,
            `æ”»å‡» +${çªç ´å¥–åŠ±.æ”»å‡»}`,
            `é˜²å¾¡ +${çªç ´å¥–åŠ±.é˜²å¾¡}`,
            `è¡€é‡ +${çªç ´å¥–åŠ±.è¡€é‡}`
        );
    }

    // å¤„ç†äº‹ä»¶é™„åŠ æ•ˆæœ
    if (å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ) {
        if (å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.æ”»å‡») {
            equipment.æ­¦å™¨.atk += å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.æ”»å‡»;
            player.æ”»å‡» += å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.æ”»å‡»;
            å›å¤å†…å®¹.push(`(é¡¿æ‚Ÿ)æ”»å‡» +${å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.æ”»å‡»}`);
        }
        if (å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.é˜²å¾¡) {
            equipment.æ­¦å™¨.def += å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.é˜²å¾¡;
            player.é˜²å¾¡ += å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.é˜²å¾¡;
            å›å¤å†…å®¹.push(`(é¡¿æ‚Ÿ)é˜²å¾¡ +${å‘ç”Ÿäº‹ä»¶.é™„åŠ æ•ˆæœ.é˜²å¾¡}`);
        }
    }

    // éšæœºå¯¹è¯
    const å¯¹è¯è¡¨ = {
  "å­¤å‚²": [
    "å“¼ï¼Œè¿˜ç®—æœ‰ç‚¹é•¿è¿›ã€‚",  
    "å‹‰å¼ºé…å¾—ä¸Šæˆ‘çš„åŠ›é‡ã€‚",  
    "ä¸è¦å¾—æ„ï¼Œè¿™ä¸è¿‡æ˜¯åŸºç¡€ã€‚",  
    "å‡¡äººï¼Œä½ çš„æ‚Ÿæ€§å°šå¯ã€‚"
  ],
  "å†·å†½": [
    "å‰‘é”‹æ‰€è‡³ï¼Œéœœå¯’ä¸åŒ–ã€‚",  
    "ä½ çš„å¿ƒï¼Œè¿˜ä¸å¤Ÿé™ã€‚",  
    "æ€æ°”å¤ªé‡ï¼Œåéœ²ç ´ç»½ã€‚",  
    "å†°å¿ƒè¯€ï¼Œå†ç»ƒä¸‰éã€‚"
  ],
  "ç‹‚æš´": [
    "å“ˆå“ˆå“ˆï¼ç—›å¿«ï¼",  
    "å†æ¥ï¼æˆ‘è¿˜èƒ½æ›´å¼ºï¼",  
    "ä¸å¤Ÿä¸å¤Ÿï¼ç»§ç»­ä¿®ç‚¼ï¼",  
    "è§è¡€æ–¹å½’ï¼æ€ï¼"
  ],
  "æ²‰é™": [
    "å‰‘æ„å¦‚æ°´ï¼Œå¿ƒæ­¢åˆ™æ˜ã€‚",  
    "ä½ çš„å‘¼å¸ä¹±äº†ã€‚",  
    "ä¸‰åƒå‰‘é“ï¼Œå”¯é™å¾—çœŸã€‚",  
    "â€¦â€¦ï¼ˆé»˜ç„¶æ³¨è§†ï¼‰"
  ],
  "å—œè¡€": [
    "æˆ‘æ¸´äº†â€¦â€¦å†æ–©ä¸€äººï¼",  
    "é²œè¡€çš„å‘³é“ï¼Œä»¤äººæ²‰é†‰ã€‚",  
    "ä½ çš„æ€æ„ï¼Œæˆ‘å¾ˆå–œæ¬¢ã€‚",  
    "ä¸é¥®è¡€ï¼Œä½•ä»¥å¼€é”‹ï¼Ÿ"
  ],
  "å¿ è¯š": [
    "æ­¤ç”Ÿå”¯éšä¸»äººä¸€å‰‘ã€‚",  
    "æ‚¨çš„æ„å¿—ï¼Œä¾¿æ˜¯æˆ‘çš„æ–¹å‘ã€‚",  
    "å‰‘åœ¨äººåœ¨ï¼Œå‰‘äº¡äººäº¡ã€‚",  
    "èª“æ­»ç›¸æŠ¤ã€‚"
  ],
  "æ¡€éªœ": [
    "å°±è¿™ç‚¹æœ¬äº‹ä¹Ÿé…ç”¨æˆ‘ï¼Ÿ",  
    "å¤©åœ°ä¹‹å¤§ï¼Œè°èƒ½é©¯æˆ‘ï¼Ÿ",  
    "ä½ çš„å‰‘æ³•ï¼Œé…ä¸ä¸Šæˆ‘çš„é”‹èŠ’ã€‚",  
    "æ±‚æˆ‘ï¼Œæˆ–è®¸æ•™ä½ ä¸€æ‹›åŠå¼ã€‚"
  ],
  "æ·¡æ¼ ": [
    "èƒœè´Ÿç”Ÿæ­»ï¼Œä¸æˆ‘ä½•å¹²ã€‚",  
    "å—¯ã€‚ï¼ˆæ•·è¡åº”å£°ï¼‰",  
    "ä½ ç»ƒä½ çš„ï¼Œæˆ‘çœ‹æˆ‘çš„ã€‚",  
    "åƒå¹´å…‰é˜´ï¼Œä¸è¿‡ä¸€ç¬ã€‚"
  ],
  "æ‚²æ‚¯": [
    "å‰‘å¯æ–©æ•Œï¼Œäº¦å¯æ¸¡äººã€‚",  
    "ä½ å¿ƒä¸­çš„æ¨ï¼Œå¤ªé‡äº†â€¦â€¦",  
    "è¿™ä¸€å¼ï¼Œæœ¬ä¸ºå®ˆæŠ¤è€Œç”Ÿã€‚",  
    "åœæ‰‹å§ï¼Œä»–å·²æ— æˆ˜æ„ã€‚"
  ],
  "é‚ªå¼‚": [
    "å˜»å˜»â€¦â€¦æƒ³å¬å¬å‰‘å“­çš„å£°éŸ³å—ï¼Ÿ",  
    "ä½ å†…å¿ƒçš„é»‘æš—ï¼ŒçœŸç¾å‘³å•Šã€‚",  
    "æˆ‘è‹¥å‡ºé˜ï¼Œå¿…å™¬ä¸€é­‚ã€‚",  
    "ææƒ§ï¼Ÿé‚£æ˜¯å‰‘æœ€å¥½çš„å…»æ–™ã€‚"
  ],
  "è‚ƒæ€": [
    "åæ­¥ä¹‹å†…ï¼Œçš†å¯æ–©ã€‚",  
    "å‡ºå‰‘ï¼Œå‹¿ç•™ä½™åœ°ã€‚",  
    "æˆ˜åœºæ— æ…ˆæ‚²ã€‚",  
    "ä½ çš„çŠ¹è±«ï¼Œä¼šå®³æ­»ä½ ã€‚"
  ],
  "çµåŠ¨": [
    "å‰‘å¦‚é£ç‡•ï¼Œèº«ä¼¼æ¸¸é¾™~",  
    "ç¬¨ï¼è¦åƒé£ä¸€æ ·è½»ï¼",  
    "çœ‹æˆ‘ç»™ä½ èˆä¸ªå‰‘èŠ±ï¼",  
    "æ‹›å¼æ˜¯æ­»çš„ï¼Œäººæ˜¯æ´»çš„å‘€ï¼"
  ],
  "æ²§æ¡‘": [
    "ä¸‰ç™¾å¹´å‰é‚£ä¸€æˆ˜â€¦â€¦ç½¢äº†ï¼Œä¸æä¹Ÿç½¢ã€‚",  
    "å¹´è½»äººï¼Œä½ çš„è·¯è¿˜é•¿ã€‚",  
    "å‰‘é”ˆäº†ï¼Œäººå¿ƒä¹Ÿä¼šé”ˆå—ï¼Ÿ",  
    "æ›¾ç»æŒæˆ‘ä¹‹äººï¼Œéƒ½å·²ä½œå¤ã€‚"
  ],
  "ç‹‚å‚²": [
    "å¤©ä¸‹å‰‘é“ï¼Œå”¯æˆ‘ç‹¬å°Šï¼",  
    "ä¸æœï¼Ÿæ¥æˆ˜ï¼",  
    "æˆ‘è¿™ä¸€å‰‘ï¼Œå¯ç ´è‹ç©¹ï¼",  
    "è¼èšä¹Ÿé…è®ºå‰‘ï¼Ÿ"
  ],
  "å¯‚ç­": [
    "ä¸‡ç‰©ç»ˆå½’è™šæ— â€¦â€¦",  
    "å‰‘é“å°½å¤´ï¼Œå”¯æœ‰å¯‚ç„¶ã€‚",  
    "ä½ å¬ï¼Œé£ä¸­æœ‰é€è€…çš„å¹æ¯ã€‚",  
    "ç”Ÿæ­»è½®å›ï¼Œä¸è¿‡ä¸€å‰‘ä¹‹éš”ã€‚"
  ],
  "å®ˆæŠ¤": [
    "åªè¦æˆ‘åœ¨ï¼Œæ— äººå¯ä¼¤ä½ ã€‚",  
    "æ­¤å‰‘ç«‹å¤„ï¼Œä¾¿æ˜¯å‡€åœŸã€‚",  
    "åˆ«æ€•ï¼Œæˆ‘ä¸€ç›´åœ¨ã€‚",  
    "ä»¥å‰‘ä¸ºèª“ï¼ŒæŠ¤ä½ ä¸€ä¸–å‘¨å…¨ã€‚"
  ]
};
    
    if (Math.random() > 0.5) {
        å›å¤å†…å®¹.push(`\n${å‰‘çµ.å§“å}ï¼šã€Œ${å¯¹è¯è¡¨[å‰‘çµ.æ€§æ ¼][Math.floor(Math.random() * 3)]}ã€`);
    }

    // ä¿å­˜æ•°æ®
    await Write_player(usr_qq, player);
    await Write_equipment(usr_qq, equipment);

    e.reply(å›å¤å†…å®¹.join("\n"));
    return true;
}
async  huaqiao(e) {
    // åŸºç¡€æ£€æŸ¥ï¼ˆç¾¤èŠã€è´¦å·ã€åœ°å›¾ç­‰ï¼‰
    if (!e.isGroup) return;
    let usr_qq = e.user_id;
    if (!await existplayer(usr_qq)) return;
    
    let player = await data.getData("player", usr_qq);
 

    let equipment = await Read_equipment(usr_qq);
    // æ­¦å™¨æ£€æŸ¥
    if (!isNotNull(equipment.æ­¦å™¨.å‰‘å¢ƒ)) {
        e.reply("ä½ è¿™å•¥æ½œåŠ›å•Š");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ == "å‡¡é“") {
        e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 6) {
        e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°èƒ½éšä¾¿è½¬åŒ–çš„é˜¶æ®µå§ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.é˜ == 1) {
        e.reply("å‰‘å·²ç»è¢«è½¬åŒ–ä¸ºé˜äº†");
        return false;
    }

    // è®°å½•åŸå§‹å€¼ï¼ˆç”¨äºè¿˜åŸè®¡ç®—ï¼‰
    const originalAtk = equipment.æ­¦å™¨.atk;
    const originalDef = equipment.æ­¦å™¨.def;

    // å‰‘ -> é˜è½¬æ¢ï¼ˆæ”»å‡»é™ä½60%ï¼Œé˜²å¾¡æå‡60%ï¼‰
    equipment.æ­¦å™¨.atk = Math.floor(originalAtk * 0.4);  // å‰©ä½™40%æ”»å‡»
    equipment.æ­¦å™¨.def = Math.floor(originalDef * 1.6);  // æå‡60%é˜²å¾¡
    equipment.æ­¦å™¨.å‰‘ = 0;
    equipment.æ­¦å™¨.é˜ = 1;

    // æ›´æ–°ç©å®¶å±æ€§ï¼ˆå·®å€¼è®¡ç®—ï¼‰
    player.æ”»å‡» += (equipment.æ­¦å™¨.atk - originalAtk);
    player.é˜²å¾¡ += (equipment.æ­¦å™¨.def - originalDef);

    await Write_player(usr_qq, player);
    await Write_equipment(usr_qq, equipment);
    e.reply(`ã€å‰‘åŒ–é˜ã€‘æ”»å‡»é™è‡³40%ï¼Œé˜²å¾¡æå‡60%ï¼\nå½“å‰æ”»å‡»ï¼š${equipment.æ­¦å™¨.atk}\nå½“å‰é˜²å¾¡ï¼š${equipment.æ­¦å™¨.def}`);
    return true;
}

async  huajian(e) {
   if (!e.isGroup) return;
    let usr_qq = e.user_id;
    if (!await existplayer(usr_qq)) return;
    
    let player = await data.getData("player", usr_qq);
 

    let equipment = await Read_equipment(usr_qq);
    // æ­¦å™¨æ£€æŸ¥
    if (!isNotNull(equipment.æ­¦å™¨.å‰‘å¢ƒ)) {
        e.reply("ä½ è¿™å•¥æ½œåŠ›å•Š");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ == "å‡¡é“") {
        e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 6) {
        e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°èƒ½éšä¾¿è½¬åŒ–çš„é˜¶æ®µå§ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘ == 1) {
        e.reply("é˜å·²ç»è¢«è½¬åŒ–ä¸ºå‰‘äº†");
        return false;
    }

    // è®°å½•åŸå§‹å€¼
    const originalAtk = equipment.æ­¦å™¨.atk;
    const originalDef = equipment.æ­¦å™¨.def;

    // é˜ -> å‰‘è½¬æ¢ï¼ˆæ”»å‡»æå‡150%ï¼Œé˜²å¾¡é™ä½37.5%ï¼‰
    equipment.æ­¦å™¨.atk = Math.floor(originalAtk / 0.4);  // æ¢å¤åŸå§‹æ”»å‡»å¹¶é¢å¤–æå‡50%
    equipment.æ­¦å™¨.def = Math.floor(originalDef / 1.6); // æ¢å¤åŸå§‹é˜²å¾¡å¹¶é™ä½37.5%
    equipment.æ­¦å™¨.å‰‘ = 1;
    equipment.æ­¦å™¨.é˜ = 0;

    // æ›´æ–°ç©å®¶å±æ€§
    player.æ”»å‡» += (equipment.æ­¦å™¨.atk - originalAtk);
    player.é˜²å¾¡ += (equipment.æ­¦å™¨.def - originalDef);

    await Write_player(usr_qq, player);
    await Write_equipment(usr_qq, equipment);
    e.reply(`ã€é˜åŒ–å‰‘ã€‘æ”»å‡»æå‡150%ï¼Œé˜²å¾¡é™è‡³62.5%ï¼\nå½“å‰æ”»å‡»ï¼š${equipment.æ­¦å™¨.atk}\nå½“å‰é˜²å¾¡ï¼š${equipment.æ­¦å™¨.def}`);
    return true;
}

            getLevelId(ç­‰çº§) {
        const ç­‰çº§è¡¨ = ["å‡¡é“","å‰‘èƒ","é€šçµ","é“ç—•","ç ´å¦„","å½’å¢Ÿ","å¤ªåˆ","æé“","é¸¿è’™å¸å‰‘","ä¸æœ½ä»™å‰‘"];
        return ç­‰çº§è¡¨.indexOf(ç­‰çº§) + 1;
    }
    async dujie(e) {
    // åŸºç¡€æ£€æŸ¥ï¼ˆç¾¤èŠã€è´¦å·ã€åœ°å›¾ç­‰ï¼‰
    if (!e.isGroup) return;
    let usr_qq = e.user_id;
    if (!await existplayer(usr_qq)) return;
    
    let player = await data.getData("player", usr_qq);


    let equipment = await Read_equipment(usr_qq);
    // æ­¦å™¨æ£€æŸ¥
    if (!isNotNull(equipment.æ­¦å™¨.å‰‘å¢ƒ)) {
        e.reply("ä½ è¿™å•¥æ½œåŠ›å•Š");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ == 0) {
        e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 8) {
        e.reply("ä½ è¿™å‰‘è¿˜æ²¡åˆ°èƒ½æ‰¿å—å¤©é›·æ·¬ç‚¼çš„é˜¶æ®µå§ï¼Ÿ");
        return false;
    }

    // å¼€å§‹å¼•é›·æ·¬ç«
    e.reply("ä½ å‰‘æŒ‡è‹ç©¹ï¼Œå¼•åŠ¨ä¹å¤©ç¥é›·ï¼");
    await sleep(3000);
    e.reply("å¤©ç©¹è£‚å¼€ä¸€é“ç¼éš™ï¼Œæ»šæ»šé›·äº‘æ±‡èšæˆæ¼©æ¶¡...");
    await sleep(5000);

    // ç¬¬ä¸€é‡é›·åŠ« - æ·¬ä½“
    let æ·¬ä½“ä¼¤å®³ = Math.trunc(Math.random() * (30000000 - 5000000) + 30000000);
    if (player.å½“å‰è¡€é‡ > æ·¬ä½“ä¼¤å®³) {
        player.å½“å‰è¡€é‡ -= æ·¬ä½“ä¼¤å®³;
        e.reply([
            "âš¡ç¬¬ä¸€é‡ã€æ·¬ä½“é›·åŠ«ã€è½°ç„¶è½ä¸‹ï¼",
            `å‰‘èº«å‰§çƒˆéœ‡é¢¤ï¼Œæ‰¿å—äº†${æ·¬ä½“ä¼¤å®³}ç‚¹é›·å‡»ä¼¤å®³`,
            `å½“å‰è¡€é‡ï¼š${player.å½“å‰è¡€é‡}`,
            "å‰‘ä½“è¡¨é¢æ‚è´¨è¢«é›·ç”µæ·¬å‡ºï¼Œé”‹èŠ’åˆç°ï¼"
        ].join("\n"));
        
        // æ·¬ç‚¼æ•ˆæœ
        equipment.æ­¦å™¨.atk += 50000000;
        equipment.æ­¦å™¨.def += 30000000;
        player.æ”»å‡» += 50000000;
        player.é˜²å¾¡ += 30000000;
    } else {
        player.å½“å‰è¡€é‡ = 0;
        await Write_player(usr_qq, player);
        return e.reply("å‰‘ä½“æ‰¿å—ä¸ä½é›·åŠ«ï¼Œæ·¬ç‚¼å¤±è´¥ï¼");
    }
    await new Promise(resolve => setTimeout(resolve, 6000));  

    // ç¬¬äºŒé‡é›·åŠ« - å‡é­‚
    let å‡é­‚ä¼¤å®³ = Math.trunc(Math.random() * (50000000 - 8000000) + 50000000);
    if (player.å½“å‰è¡€é‡ > å‡é­‚ä¼¤å®³) {
        player.å½“å‰è¡€é‡ -= å‡é­‚ä¼¤å®³;
        e.reply([
            "ğŸŒ©ï¸ç¬¬äºŒé‡ã€å‡é­‚é›·åŠ«ã€æ¥è¸µè€Œè‡³ï¼",
            `ç´«è‰²å¤©é›·è´¯ç©¿å‰‘èº«ï¼Œé€ æˆ${å‡é­‚ä¼¤å®³}ç‚¹é­‚å‡»ä¼¤å®³`,
            `å½“å‰è¡€é‡ï¼š${player.å½“å‰è¡€é‡}`,
            "å‰‘çµåœ¨é›·å…‰ä¸­å‘å‡ºæ¸…è¶Šå‰‘é¸£ï¼Œé­‚é­„æ›´åŠ å‡å®ï¼"
        ].join("\n"));
        
        // å¼ºåŒ–å‰‘çµ
        if (equipment.æ­¦å™¨.å‰‘çµ) {
            equipment.æ­¦å™¨.å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ += 80000000;
            equipment.æ­¦å™¨.å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ += 50000000;
            player.æ”»å‡» += 80000000;
            player.é˜²å¾¡ += 50000000;
        }
    } else {
        player.å½“å‰è¡€é‡ = 0;
        await Write_player(usr_qq, player);
        return e.reply("å‰‘çµé™©äº›è¢«å¤©é›·éœ‡æ•£ï¼Œæ·¬ç‚¼ä¸­æ–­ï¼");
    }
    await new Promise(resolve => setTimeout(resolve, 6000));  

    // ç¬¬ä¸‰é‡é›·åŠ« - å¼€å¤©
    let å¼€å¤©ä¼¤å®³ = Math.trunc(Math.random() * (80000000 - 10000000) + 80000000);
    if (player.å½“å‰è¡€é‡ > å¼€å¤©ä¼¤å®³) {
        player.å½“å‰è¡€é‡ -= å¼€å¤©ä¼¤å®³;
        e.reply([
            "ğŸŒŒç¬¬ä¸‰é‡ã€å¼€å¤©é›·åŠ«ã€æ’•è£‚è™šç©ºï¼",
            `é‡‘è‰²é›·é¾™ç›´åŠˆå‰‘é”‹ï¼Œé€ æˆ${å¼€å¤©ä¼¤å®³}ç‚¹è‡´å‘½ä¼¤å®³`,
            `å½“å‰è¡€é‡ï¼š${player.å½“å‰è¡€é‡}`,
            "å‰‘èº«æµ®ç°å¤©é“çº¹è·¯ï¼Œå¼•åŠ¨å¤©åœ°å…±é¸£ï¼"
        ].join("\n"));
        
        // ç»ˆæå¼ºåŒ–
        const æå‡å€æ•° = equipment.æ­¦å™¨.å‰‘å¢ƒ * 0.5;
        equipment.æ­¦å™¨.atk *= (1 + æå‡å€æ•°);
        equipment.æ­¦å™¨.def *= (1 + æå‡å€æ•° * 0.8);
        equipment.æ­¦å™¨.HP *= (1 + æå‡å€æ•° * 1.2);
        
        const atkå¢ç›Š = equipment.æ­¦å™¨.atk * æå‡å€æ•°;
        const defå¢ç›Š = equipment.æ­¦å™¨.def * æå‡å€æ•° * 0.8;
        const hpå¢ç›Š = equipment.æ­¦å™¨.HP * æå‡å€æ•° * 1.2;
        
        player.æ”»å‡» += atkå¢ç›Š;
        player.é˜²å¾¡ += defå¢ç›Š;
        player.è¡€é‡ä¸Šé™ += hpå¢ç›Š;

        // æ·»åŠ é›·åŠ«å°è®°
        equipment.æ­¦å™¨.æ·¬ç«å¼•é›· += 1;
        
        e.reply([
            "é›·äº‘æ¸æ•£ï¼Œæ·¬ç‚¼æˆåŠŸï¼",
            `æ”»å‡»æ°¸ä¹…æå‡ ${Math.floor(æå‡å€æ•°*100)}% (+${atkå¢ç›Š})`,
            `é˜²å¾¡æ°¸ä¹…æå‡ ${Math.floor(æå‡å€æ•°*80)}% (+${defå¢ç›Š})`,
            `ç”Ÿå‘½æ°¸ä¹…æå‡ ${Math.floor(æå‡å€æ•°*120)}% (+${hpå¢ç›Š})`,
            `æ­å–œï¼`
        ].join("\n"));
    } else {
        player.å½“å‰è¡€é‡ = 0;
        player.ä¿®ä¸º -= player.ä¿®ä¸º * 0.1; // æŸå¤±10%ä¿®ä¸º
        await Write_player(usr_qq, player);
        return e.reply("å‰‘ä½“å´©è£‚ï¼æŸå¤±10%ä¿®ä¸ºä¿ä½äº†å‰‘é­„...");
    }

    // ä¿å­˜æ•°æ®
    await Write_player(usr_qq, player);
    await Write_equipment(usr_qq, equipment);
    return true;
}
async jianjing(e) {
    // åŸºç¡€æ£€æŸ¥
    if (!e.isGroup) return;
    let usr_qq = e.user_id;
    
    // æ£€æŸ¥ç©å®¶æ˜¯å¦å­˜åœ¨
    let ifexistplay = await existplayer(usr_qq);
    if (!ifexistplay) return;
    
    let player = await data.getData("player", usr_qq);
  

    let equipment = await Read_equipment(usr_qq);
    // æ£€æŸ¥æ­¦å™¨æ˜¯å¦ç‚¼åŒ–
    if (!isNotNull(equipment.æ­¦å™¨.å‰‘å¢ƒ)) {
        e.reply("ä½ è¿™å•¥æ½œåŠ›å•Š");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ == "å‡¡é“") {
        e.reply("ç‚¼åŒ–äº†å—ï¼Ÿ");
        return false;
    }
    if (equipment.æ­¦å™¨.å‰‘å¢ƒ < 2) {
        e.reply("ä½ æœ‰å‰‘çµå—ï¼Ÿ");
        return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å‰‘çµ
   

    const å‰‘çµ = equipment.æ­¦å™¨.å‰‘çµ;
    
    // è·å–å½“å‰å‰‘çµç­‰çº§å’Œä¸‹ä¸€çº§æ‰€éœ€ç»éªŒ
    const å½“å‰ç­‰çº§ = å‰‘çµ.å½“å‰ç­‰çº§ || 1;
    const ä¸‹ä¸€ç­‰çº§ = å½“å‰ç­‰çº§ + 1;
    const æ‰€éœ€ç»éªŒ = this.getJianlingExpRequirement(ä¸‹ä¸€ç­‰çº§);
    
    // æ£€æŸ¥ç©å®¶ç»éªŒæ˜¯å¦è¶³å¤Ÿ
    if (player.ä¿®ä¸º < æ‰€éœ€ç»éªŒ) {
        return e.reply([
            "ç»éªŒä¸è¶³æ— æ³•å‡çº§å‰‘çµ",
            `å½“å‰å‰‘çµç­‰çº§: ${å½“å‰ç­‰çº§}`,
            `ä¸‹ä¸€ç­‰çº§éœ€è¦: ${æ‰€éœ€ç»éªŒ}ç»éªŒ`,
            `ä½ çš„ç»éªŒ: ${player.ä¿®ä¸º}`
        ].join("\n"));
    }
    
    // æ‰£é™¤ç»éªŒå¹¶å‡çº§
    player.ä¿®ä¸º -= æ‰€éœ€ç»éªŒ;
    å‰‘çµ.å½“å‰ç­‰çº§ = ä¸‹ä¸€ç­‰çº§;
    
    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è¿›åŒ–é˜¶æ®µ
    const è¿›åŒ–é˜¶æ®µ = this.getEvolutionStage(ä¸‹ä¸€ç­‰çº§);
    if (è¿›åŒ–é˜¶æ®µ !== å‰‘çµ.é˜¶æ®µ) {
        å‰‘çµ.é˜¶æ®µ = è¿›åŒ–é˜¶æ®µ;
        await e.reply(`âœ¨ã€${å‰‘çµ.å§“å}ã€‘çªç ´è‡³${è¿›åŒ–é˜¶æ®µ}é˜¶æ®µï¼âœ¨`);
    }
    
    // è®¡ç®—å±æ€§æå‡ï¼ˆå›ºå®šæˆé•¿ï¼‰
    const å±æ€§æå‡ = this.getJianlingStatsUpgrade(ä¸‹ä¸€ç­‰çº§, å‰‘çµ.é˜¶æ®µ);
    å‰‘çµ.æ”»å‡»å±æ€§åŠ æˆ += å±æ€§æå‡.æ”»å‡»;
    å‰‘çµ.é˜²å¾¡å±æ€§åŠ æˆ += å±æ€§æå‡.é˜²å¾¡;
    å‰‘çµ.è¡€é‡å±æ€§åŠ æˆ += å±æ€§æå‡.è¡€é‡;
    
    // æ›´æ–°ç©å®¶å±æ€§
    player.æ”»å‡» += å±æ€§æå‡.æ”»å‡»;
    player.é˜²å¾¡ += å±æ€§æå‡.é˜²å¾¡;
    player.è¡€é‡ä¸Šé™ += å±æ€§æå‡.è¡€é‡;
    
    // ä¿å­˜æ•°æ®
    await Write_player(usr_qq, player);
    await Write_equipment(usr_qq, equipment);
    
    // å›å¤å‡çº§ä¿¡æ¯
    await e.reply([
        `ã€${å‰‘çµ.å§“å}ã€‘å‡çº§æˆåŠŸï¼`,
        `å½“å‰ç­‰çº§: ${ä¸‹ä¸€ç­‰çº§} (${å‰‘çµ.é˜¶æ®µ})`,
        `æ¶ˆè€—ç»éªŒ: ${æ‰€éœ€ç»éªŒ}`,
        `æ”»å‡»æå‡: +${å±æ€§æå‡.æ”»å‡»}`,
        `é˜²å¾¡æå‡: +${å±æ€§æå‡.é˜²å¾¡}`,
        `è¡€é‡æå‡: +${å±æ€§æå‡.è¡€é‡}`,
        `å‰‘çµå¿ƒæƒ…: ${å‰‘çµ.å¿ƒæƒ… || 50}`
    ].join("\n"));
    
    return true;
}

// å‰‘çµè¿›åŒ–é˜¶æ®µå®šä¹‰
getEvolutionStage(level) {
    if (level < 2) return "çµè¯†";
    if (level < 3) return "åˆå½¢";
    if (level < 4) return "å‡å®";
    if (level < 5) return "é€šçµ";
    if (level < 6) return "åŒ–å½¢";
    if (level < 7) return "è§‰é†’";
    if (level < 8) return "çœŸçµ";
    if (level < 9) return "åœ£ä½“";
    if (level < 10) return "ä»™é­‚";
    return "ä¸ç­ç¥é­‚";
}

// è·å–å‰‘çµå‡çº§æ‰€éœ€ç»éªŒï¼ˆæŒ‰é˜¶æ®µè°ƒæ•´ï¼‰
getJianlingExpRequirement(level) {
    const é˜¶æ®µåŸºæ•° = Math.floor((level - 1) / 10) + 1;
    return Math.floor(1000000 * é˜¶æ®µåŸºæ•° * Math.pow(1.3, (level - 1) % 10));
}

// è·å–å‰‘çµå‡çº§å±æ€§æå‡ï¼ˆé˜¶æ®µå›ºå®šæˆé•¿ï¼‰
getJianlingStatsUpgrade(level, stage) {
    // åŸºç¡€å€¼ç”±é˜¶æ®µå†³å®š
    const é˜¶æ®µç³»æ•° = {
        "çµè¯†": 1,
        "åˆå½¢": 2,
        "å‡å®": 4,
        "é€šçµ": 8,
        "åŒ–å½¢": 16,
        "è§‰é†’": 32,
        "çœŸçµ": 64,
        "åœ£ä½“": 128,
        "ä»™é­‚": 256,
        "ä¸ç­ç¥é­‚": 512
    };
    
    const ç³»æ•° = é˜¶æ®µç³»æ•°[stage] || 1;
    return {
        æ”»å‡»: 5000000000 * ç³»æ•°,
        é˜²å¾¡: 4000000000 * ç³»æ•°,
        è¡€é‡: 6000000000 * ç³»æ•°
    };
}
    
    getRequiredFireSpirit(å‰‘å¢ƒ) {
    const æ·¬ç‚¼éœ€æ±‚è¡¨ = {
        "å‰‘èƒ": 10000,           
        "é€šçµ": 100000,         
        "é“ç—•": 1000000,         
        "ç ´å¦„": 10000000,         
        "å½’å¢Ÿ": 100000000,        
        "å¤ªåˆ": 1000000000,      
        "æé“": 10000000000,    
        "é¸¿è’™å¸å‰‘": 100000000000,
        "ä¸æœ½ä»™å‰‘": 1000000000000 
    };
    return æ·¬ç‚¼éœ€æ±‚è¡¨[å‰‘å¢ƒ] || 0;
}

    // è·å–ä¸‹ä¸€ç­‰çº§
    getNextLevel(current) {
        const ç­‰çº§è¡¨ = [
          "å‡¡é“", "å‰‘èƒ","é€šçµ","é“ç—•","ç ´å¦„","å½’å¢Ÿ","å¤ªåˆ","æé“","é¸¿è’™å¸å‰‘","ä¸æœ½ä»™å‰‘"
        ];
        const index = ç­‰çº§è¡¨.indexOf(current);
        return index < ç­‰çº§è¡¨.length - 1 ? ç­‰çº§è¡¨[index + 1] : current;
    }

    // è·å–è¿›åŒ–åŠ æˆå€æ•°
    getUpgradeMultiplier(å½“å‰ç­‰çº§) {
       {
    const ä¸‰ç»´å€æ•°è¡¨ = {
        "å‡¡é“":       { æ”»å‡»: 0,   é˜²å¾¡: 0,   ç”Ÿå‘½: 0   },
        "å‰‘èƒ":       { æ”»å‡»: 1,   é˜²å¾¡: 1,   ç”Ÿå‘½: 1   },
        "é€šçµ":       { æ”»å‡»: 3,   é˜²å¾¡: 2,   ç”Ÿå‘½: 2   },
        "é“ç—•":       { æ”»å‡»: 5/3,   é˜²å¾¡: 3/2,   ç”Ÿå‘½: 3/2   },
        "ç ´å¦„":       { æ”»å‡»: 10/5,  é˜²å¾¡: 5/3,   ç”Ÿå‘½: 5/3   },
        "å½’å¢Ÿ":       { æ”»å‡»: 20/10,  é˜²å¾¡: 10/5,  ç”Ÿå‘½: 10/5  },
        "å¤ªåˆ":       { æ”»å‡»: 50/20,  é˜²å¾¡: 20/10,  ç”Ÿå‘½: 20/10  },
        "æé“":       { æ”»å‡»: 100/50, é˜²å¾¡: 50/20,  ç”Ÿå‘½: 50/20  },
        "é¸¿è’™å¸å‰‘":   { æ”»å‡»: 300/100, é˜²å¾¡: 100/50, ç”Ÿå‘½: 100/50 },
        "ä¸æœ½ä»™å‰‘":   { æ”»å‡»: 1000/300,é˜²å¾¡: 300/100, ç”Ÿå‘½: 300/100 }
    };
    return ä¸‰ç»´å€æ•°è¡¨[å½“å‰ç­‰çº§] ;
}
       
    }










}
