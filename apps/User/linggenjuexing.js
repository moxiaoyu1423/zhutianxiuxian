import { plugin, verc, config, data } from '../../api/api.js';
import fs from 'fs';
import {
  existplayer,
  Write_player,
  Write_equipment,
  isNotNull,
  player_efficiency,
  get_random_fromARR,
  Read_player,
  Read_equipment,
  Add_HP,
   zd_battle,
  exist_najie_thing,
  Add_ä¿®ä¸º,
  Add_è¡€æ°”,
  __PATH,
  Add_å¯¿å…ƒ,
  Add_najie_thing,
  dujie,
  LevelTask,
  get_log_img,
  channel,
  ForwardMsg
} from '../../model/xiuxian.js';
export class linggenjuexing extends plugin {
  constructor() {
    super({
      name: 'Yunzai_Bot_linggenjuexing',
      dsc: 'ä¿®ä»™çµæ ¹è§‰é†’æ¨¡å—',
      event: 'message',
      priority: 600,
      rule: [
            { 
            reg: '^#å¥å“å¾€ä¸–ä¹åœŸä¹‹ç« $', 
            fnc: 'zouxiangwangshi' 
            },
            { 
            reg: '^#çœŸæˆ‘è§‰é†’$',
            fnc: 'zhenwojuexing' 
            },
            { 
            reg: '^#æµè¤è§‰é†’$',
            fnc: 'liuyingjuexing' 
            },
            {
            reg: '^#åœ£ä½“è§‰é†’$',
            fnc: 'shengtijuexing'
            },
            {
            reg: '^#éœ¸ä½“è§‰é†’$',
            fnc: 'batijuexing'
            },
            {
            reg: '^#å¦–ä½“è§‰é†’$',
            fnc: 'yaotijuexing'
            },
      ],
      
    }); 
  }  /* ---------- ç¬¬ä¸€æ­¥ï¼šå¼¹å‡ºé€‰é¡¹ ---------- */
async zouxiangwangshi(e) {
    if (!verc({ e })) return false;
    const usr_qq = e.user_id.toString().replace('qg_', '');
    const has = await exist_najie_thing(usr_qq, 'å¾€ä¸–ä¹åœŸä¹‹ç« ', 'é“å…·');
    if (!has) return e.reply('ã€å¾€ä¸–ä¹åœŸã€‘ä½ å°šæœªè·å¾—"å¾€ä¸–ä¹åœŸä¹‹ç« "ï¼Œæ— æ³•å¼€å¯ä»ªå¼ã€‚');

    const broadcast = [
      `è¯¸å¤©ä¸‡ç•Œå¿½è€Œå“èµ·æ°´æ™¶è½»é¸£ï¼Œä¸€åº§è¢«å²æœˆå°˜å°çš„ã€Œå¾€ä¸–ä¹åœŸã€åœ¨æ˜Ÿç©ºä¸­ç»½æ”¾ã€‚`,
      `åä¸‰é“åˆ»å°ç¯ç»•æˆç¯ï¼Œç»ˆæœ«çš„è‹±æ¡€ä¹‹åº§äºèŠ±æµ·ä¸­æ˜¾å½¢ã€‚`,
      `æ— ç‘•çš„å°‘å¥³è¸èŠ±è€Œæ¥ï¼Œå¾®ç¬‘è¯¢é—®ï¼š`,
      `ã€Œå—¨ï¼Œæƒ³å’Œæˆ‘ä¸€èµ·ï¼Œè®©è¿™ä¸ªä¸–ç•Œâ€¦â€¦å˜æˆä½ å–œæ¬¢çš„æ ·å­å—ï¼Ÿã€`,
      ``,
      `ã€å¾€ä¸–ä¹åœŸã€‘å·²æ¿€æ´»ï¼`,
      `è¯·é€‰æ‹©ä½ çš„å›åº”â€”â€”`,
      `1. ã€Œæˆ‘æ„¿æ„çŒ®æ­¤èº«çµæ ¹ï¼ŒåŒ–ä½œæ— ç‘•ä¹‹äººã€‚ã€ï¼ˆè¦†ç›–çµæ ¹ï¼‰`,
      `2. ã€Œæˆ‘æ„¿ä¸ä½ å¹¶è‚©ï¼Œè€Œéå–ä»£ã€‚ã€ï¼ˆæ¶ˆè€—å¾€ä¸–ä¹åœŸä¹‹ç« ï¼Œå¬å”¤æ¬¡æ•°+1/ä¸ªï¼‰`,
      `ï¼ˆ30 ç§’å†…å›å¤ 1 æˆ– 2ï¼‰`
    ].join('\n');
    await e.reply(broadcast);

    // è®¾å®šä¸Šä¸‹æ–‡ï¼Œç­‰å¾…çº¯æ•°å­—
    this.setContext('wangshiChoice');
    return false;
  }
  /* ---------- ç¬¬äºŒæ­¥ï¼šå¤„ç†é€‰æ‹©ï¼ˆæ¡†æ¶æŠŠ 1/2 å–‚è¿›æ¥ï¼‰ ---------- */
  async wangshiChoice(e) {
    if (!verc({ e })) return false;
    const usr_qq = e.user_id.toString().replace('qg_', '');
    const player = await Read_player(usr_qq);
    
    // è·å–ç”¨æˆ·æ‹¥æœ‰çš„å¾€ä¸–ä¹åœŸä¹‹ç« æ•°é‡
    const chapterCount = await exist_najie_thing(usr_qq, 'å¾€ä¸–ä¹åœŸä¹‹ç« ', 'é“å…·');

    // ä»ä¸Šä¸‹æ–‡æ¶ˆæ¯ä¸­è·å–ç”¨æˆ·å›å¤
    let new_msg = '';
    if (this.e?.message && this.e.message[0]?.type === 'text') {
      new_msg = this.e.message[0].text.trim();
    } else if (e.msg) {
      new_msg = e.msg.trim();
    }
    
    if (new_msg === "1") {
      const æ°´æ™¶èŠ± = (await exist_najie_thing(usr_qq, 'æ— ç‘•æ°´æ™¶èŠ±', 'é“å…·')) || 0;
      const èª“çº¦è¯ = (await exist_najie_thing(usr_qq, 'èª“çº¦ä¹‹è¯', 'é“å…·')) || 0;
      if (æ°´æ™¶èŠ± < 4 || èª“çº¦è¯ < 4) {
        await e.reply(
          `ã€æ— ç‘•ä¹‹äººã€‘ææ–™ä¸è¶³ï¼\n` +
          `æ— ç‘•æ°´æ™¶èŠ±Ã—4ï¼ˆ${æ°´æ™¶èŠ±}/4ï¼‰\n` +
          `èª“çº¦ä¹‹è¯Ã—4ï¼ˆ${èª“çº¦è¯}/4ï¼‰`
        );
        this.finish('wangshiChoice');
        return;
      }
      // æ‰£ææ–™
      await Add_najie_thing(usr_qq, 'å¾€ä¸–ä¹åœŸä¹‹ç« ', 'é“å…·', -1);
      await Add_najie_thing(usr_qq, 'æ— ç‘•æ°´æ™¶èŠ±', 'é“å…·', -4);
      await Add_najie_thing(usr_qq, 'èª“çº¦ä¹‹è¯', 'é“å…·', -4);
      // æ¢çµæ ¹
      player.çµæ ¹ = {
        id: 7010020,
        name: 'çˆ±è‰å¸Œé›…',
        type: 'æ— ç‘•ä¹‹äºº',
        å½’ç±»: 'è¯¸å¤©ä¸‡ç•Œ',
        eff: 1.2,
        æ³•çƒå€ç‡: 1.5,
        æ”»å‡»: 0.8,
        é˜²å¾¡: 0.7,
        ç”Ÿå‘½: 0.9,
        ç”Ÿå‘½æœ¬æº: 50,
        ç‰¹æ®Šæ•ˆæœ: ['æ°´æ™¶èŠ±ç§', 'çœŸæˆ‘åˆ»å°']
      };
      player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
      await Write_player(usr_qq, player);

      await e.reply([
         `ä½ çŒ®ä¸Šæ— ç‘•æ°´æ™¶èŠ±ä¸èª“çº¦ä¹‹è¯ï¼ŒèŠ±æµ·å€’å·ï¼Œåˆ»å°é™ä¸´ã€‚`,
      `äº”è¡ŒåŒ–ä½œç²‰é‡‘è‰²çš„èŠ±ç“£ï¼Œé›·ç«å‡æˆæ™¶è¹çš„éœ²ç ã€‚`,
      `ã€ç³»ç»Ÿã€‘çµæ ¹å·²å˜æ›´ä¸ºï¼šæ— ç‘•ä¹‹äººÂ·çˆ±è‰å¸Œé›…`,
      `å¤©é™…å“èµ·å¥¹çš„è½»ç¬‘ï¼šã€Œä»ä»Šå¾€åï¼Œä½ çš„æ¯ä¸€æ¬¡å¿ƒè·³ï¼Œéƒ½å°†å¼€å‡ºæœ€ç¾çš„èŠ±å“¦ï½ã€`
      ].join('\n'));
      this.finish('wangshiChoice');
      return;
    }

    /* ---------- åˆ†æ”¯ 2ï¼šè¯¢é—®æ¶ˆè€—æ•°é‡ ---------- */
    if (new_msg === "2") {
      if (chapterCount <= 0) {
        await e.reply('ã€å¾€ä¸–ä¹åœŸã€‘ä½ æ²¡æœ‰å¯æ¶ˆè€—çš„"å¾€ä¸–ä¹åœŸä¹‹ç« "ã€‚');
        this.finish('wangshiChoice');
        return;
      }
      
      await e.reply(
        `ä½ é€‰æ‹©ä¸çˆ±è‰å¸Œé›…å¹¶è‚©ä½œæˆ˜ã€‚\n` +
        `ä½ å½“å‰æ‹¥æœ‰å¾€ä¸–ä¹åœŸä¹‹ç« Ã—${chapterCount}ã€‚\n` +
        `è¯·è¾“å…¥è¦æ¶ˆè€—çš„æ•°é‡ï¼ˆ1~${chapterCount}ï¼‰ï¼š\n` +
        `ï¼ˆæ¯ä¸ªå¯å¢åŠ 1æ¬¡å¬å”¤æ¬¡æ•°ï¼Œ30ç§’å†…å›å¤æ•°å­—ï¼‰`
      );
      
      // è®¾ç½®æ–°çš„ä¸Šä¸‹æ–‡ï¼Œç­‰å¾…è¾“å…¥æ•°é‡
      this.setContext('wangshiChoiceCount');
      return false;
    }

    /* ---------- è¶…æ—¶æˆ–éæ³• ---------- */
    await e.reply('é€‰æ‹©æ— æ•ˆï¼Œå·²è¶…æ—¶ã€‚ä¹åœŸä¹‹é—¨æ‚„ç„¶é—­åˆâ€¦â€¦');
    this.finish('wangshiChoice');
  }

  /* ---------- ç¬¬ä¸‰æ­¥ï¼šå¤„ç†é€‰æ‹©æ•°é‡ ---------- */
  async wangshiChoiceCount(e) {
    if (!verc({ e })) return false;
    const usr_qq = e.user_id.toString().replace('qg_', '');
    const player = await Read_player(usr_qq);
    
    // é‡æ–°è·å–ç”¨æˆ·æ‹¥æœ‰çš„å¾€ä¸–ä¹åœŸä¹‹ç« æ•°é‡
    const chapterCount = await exist_najie_thing(usr_qq, 'å¾€ä¸–ä¹åœŸä¹‹ç« ', 'é“å…·');

    // ä»ä¸Šä¸‹æ–‡æ¶ˆæ¯ä¸­è·å–ç”¨æˆ·å›å¤
    let new_msg = '';
    if (this.e?.message && this.e.message[0]?.type === 'text') {
      new_msg = this.e.message[0].text.trim();
    } else if (e.msg) {
      new_msg = e.msg.trim();
    }
    
    // è§£æè¾“å…¥çš„æ•°é‡
    const count = parseInt(new_msg);
    if (isNaN(count) || count < 1 || count > chapterCount) {
      await e.reply(`è¾“å…¥æ— æ•ˆï¼Œè¯·è¾“å…¥1~${chapterCount}ä¹‹é—´çš„æ•´æ•°ã€‚`);
      // ä¸ç»“æŸä¸Šä¸‹æ–‡ï¼Œè®©ç”¨æˆ·é‡æ–°è¾“å…¥
      return false;
    }
    
    // æ‰£é™¤ç›¸åº”æ•°é‡çš„å¾€ä¸–ä¹åœŸä¹‹ç« 
    await Add_najie_thing(usr_qq, 'å¾€ä¸–ä¹åœŸä¹‹ç« ', 'é“å…·', -count);
    
    // å¢åŠ å¬å”¤æ¬¡æ•°
    const currentSummonCount = player.çˆ±è‰å¸Œé›…å¬å”¤æ¬¡æ•° || 0;
    player.çˆ±è‰å¸Œé›…å¬å”¤æ¬¡æ•° = currentSummonCount + count;
    await Write_player(usr_qq, player);

    // æ ¹æ®æ¶ˆè€—æ•°é‡ç”Ÿæˆä¸åŒçš„å›å¤
    let replyText = '';
    if (count === 1) {
      replyText = [
        `ä½ åé€€åŠæ­¥ï¼Œå´ä¼¸æ‰‹æ¥è¿‡é£˜è½çš„æ™¶ç“£ã€‚`,
        `çˆ±è‰å¸Œé›…çœ¨äº†çœ¨çœ¼ï¼Œå°†ä¸€æ»´é—ªè€€é‡‘èŠ’çš„éœ¸è¡€æ”¾å…¥ä½ æŒå¿ƒï¼š`,
        `ã€Œé‚£å°±è¯´å®šå•¦ï¼Œä¸‹æ¬¡å¬å”¤æˆ‘æ—¶â€¦â€¦è¦å¸¦æ›´å¤šå¥½ç©çš„æ•…äº‹æ¥ï¼ã€`,
        `ã€ç³»ç»Ÿã€‘æ¶ˆè€—å¾€ä¸–ä¹åœŸä¹‹ç« Ã—1ï¼Œçˆ±è‰å¸Œé›…å¬å”¤æ¬¡æ•° +1`
      ].join('\n');
    } else {
      replyText = [
        `ä½ å–å‡º${count}æšå¾€ä¸–ä¹åœŸä¹‹ç« ï¼Œæ°´æ™¶çš„å…‰èŠ’åœ¨èŠ±æµ·ä¸­äº¤ç»‡ã€‚`,
        `çˆ±è‰å¸Œé›…è½»ç¬‘ç€æ¥è¿‡ï¼Œå°†${count}æ»´é—ªè€€é‡‘èŠ’çš„éœ¸è¡€æ”¾å…¥ä½ æŒå¿ƒï¼š`,
        `ã€Œå“å‘€ï¼Œè¿™ä¹ˆæœŸå¾…è§åˆ°æˆ‘å—ï¼Ÿé‚£å°±çº¦å®šå¥½äº†ï¼Œè¦å’Œæˆ‘åˆ›é€ ${count}æ¬¡ç¾å¥½çš„å›å¿†å“¦ï½ã€`,
        `ã€ç³»ç»Ÿã€‘æ¶ˆè€—å¾€ä¸–ä¹åœŸä¹‹ç« Ã—${count}ï¼Œçˆ±è‰å¸Œé›…å¬å”¤æ¬¡æ•° +${count}`
      ].join('\n');
    }
    
    await e.reply(replyText);
    this.finish('wangshiChoiceCount');
    return;
  }



/** çœŸæˆ‘è§‰é†’ï¼šäººä¹‹å¾‹è€… / å§‹æºå¾‹è€… äºŒæ®µè§‰é†’ */
async zhenwojuexing(e) {
    if (!e.isGroup) { e.reply('è¯·åœ¨ç¾¤èŠä¸­å®ŒæˆçœŸæˆ‘ä»ªå¼'); return; }

    const usr_qq = e.user_id.toString().replace('qg_', '');
    if (!await existplayer(usr_qq)) { e.reply('ç©å®¶ä¸å­˜åœ¨'); return; }

    const player = await Read_player(usr_qq);
    if ( player.çµæ ¹.name !== 'çˆ±è‰å¸Œé›…'&& player.çµæ ¹.name !== 'äººä¹‹å¾‹è€…Â·çˆ±è‰å¸Œé›…') {
        e.reply('åªæœ‰æ— ç‘•ä¹‹äººÂ·çˆ±è‰å¸Œé›…æ‰èƒ½å¼€å¯çœŸæˆ‘è§‰é†’'); return;
    }
    if (player.ç”Ÿå‘½æœ¬æº !== 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº) {
        e.reply('ç”Ÿå‘½æœ¬æºäºç©ºï¼Œæ— æ³•æ‰¿è½½çœŸæˆ‘æƒæŸ„'); return;
    }

    /* ---------- é˜¶æ®µåˆ¤å®š ---------- */
    const isRen = player.çµæ ¹.type === 'æ— ç‘•ä¹‹äºº';
    const isShiYuan = player.çµæ ¹.type === 'çœŸæˆ‘Â·äººä¹‹å¾‹è€…';
    if (!isRen && !isShiYuan) { e.reply('å½“å‰çŠ¶æ€æ— æ³•è§‰é†’'); return; }

    /* ---------- ææ–™æ£€æŸ¥ ---------- */
    const need = isRen
        ? { å¾€ä¸–ä¹åœŸçš„è®°å¿†ç»“æ™¶: 5, æ°¸æ’çš„ä¹å›­ä¹‹æ¯: 5, ç§˜å¢ƒæœ€ä½: 15 /*å‡†å¸*/ }
        : { æ— ç‘•ä¹‹è¯: 5, ç»ˆç„‰çš„å¯ç¤º: 5, ç§˜å¢ƒæœ€ä½: 19 /*ä»™ç‹å·¨å¤´*/ };

    for (const [name, num] of Object.entries(need).filter(([k]) => k !== 'ç§˜å¢ƒæœ€ä½')) {
        const has = await exist_najie_thing(usr_qq, name, 'é“å…·') || 0;
        if (has < num) return e.reply(`çœŸæˆ‘è§‰é†’éœ€è¦ ${num} ä¸ªã€${name}ã€‘ï¼Œå½“å‰ ${has}`);
    }

    /* ---------- å¢ƒç•Œæ£€æŸ¥ ---------- */
    if (player.mijinglevel_id < need.ç§˜å¢ƒæœ€ä½) {
        return e.reply(isRen ? 'éœ€ç§˜å¢ƒä½“ç³»è¾¾åˆ°å‡†å¸æ–¹å¯æ‰¿è½½äººä¹‹å¾‹è€…æƒæŸ„'
                            : 'éœ€ç§˜å¢ƒä½“ç³»è¾¾åˆ°ä»™ç‹å·¨å¤´æ–¹å¯æ‰¿è½½å§‹æºå¾‹è€…æƒæŸ„');
    }

    /* ---------- æ‰£é™¤ææ–™ ---------- */
    for (const [name, num] of Object.entries(need).filter(([k]) => k !== 'ç§˜å¢ƒæœ€ä½')) {
        await Add_najie_thing(usr_qq, name, 'é“å…·', -num);
    }

    /* ---------- è§‰é†’æ™‹å‡ ---------- */
    if (isRen) {
        player.çµæ ¹ = {
            id: 7010020,
            name: 'äººä¹‹å¾‹è€…Â·çˆ±è‰å¸Œé›…',
            type: 'çœŸæˆ‘Â·äººä¹‹å¾‹è€…',
            å½’ç±»: 'è¯¸å¤©ä¸‡ç•Œ',
            eff: 2.8,
            æ³•çƒå€ç‡: 3.0,
            æ”»å‡»: 2,
            é˜²å¾¡: 1.8,
            ç”Ÿå‘½: 2.2,
            ç”Ÿå‘½æœ¬æº: 150,
            ç‰¹æ®Šæ•ˆæœ: ['äººä¹‹æƒæŸ„', 'å§‹æºé¢†åŸŸ']
        };
        player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
        await Write_player(usr_qq, player);

        const txt = [
            ` æ°´æ™¶èŠ±é›¨æ´’è½ï¼Œæ— ç‘•ä¹‹å…‰æ˜ ç…§è¯¸å¤©ï¼`,
            `ä½ å°†ã€Œå¾€ä¸–ä¹åœŸçš„è®°å¿†ç»“æ™¶ã€ä¸ã€Œæ°¸æ’çš„ä¹å›­ä¹‹æ¯ã€èå…¥è¡€è„‰ï¼Œ`,
            `çœŸæˆ‘æƒæŸ„è‹é†’ï¼Œè¸å…¥ã€Œäººä¹‹å¾‹è€…ã€å‘½é€”ï¼`,
            ``,
            `ã€äººä¹‹å¾‹è€…Â·çˆ±è‰å¸Œé›…ã€‘`,
            `ä¸€å¿µèŠ±å¼€ï¼Œä¸€å¿µä¼—ç”Ÿï¼›å§‹æºåŠ èº«ï¼Œè¯¸å¤©æ— ç‘•ï¼`
        ].join('\n');
        e.reply(txt);
    } else {
        player.çµæ ¹ = {
            id: 7010020,
            name: 'å§‹æºä¹‹å¾‹è€…Â·çˆ±è‰å¸Œé›…',
            type: 'å§‹æºå¾‹è€…',
            å½’ç±»: 'è¯¸å¤©ä¸‡ç•Œ',
            eff: 5,
            æ³•çƒå€ç‡: 6,
            æ”»å‡»: 4.5,
            é˜²å¾¡: 4,
            ç”Ÿå‘½: 5,
            ç”Ÿå‘½æœ¬æº: 300,
            ç‰¹æ®Šæ•ˆæœ: ['å› æœå¹²æ¶‰', 'æ¦‚å¿µæ˜¾ç°']
        };
        player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
        await Write_player(usr_qq, player);

        const txt = [
            ` ç»ˆç„‰å¯ç¤ºé™ä¸´ï¼Œå§‹æºä¹‹æµ·æ²¸è…¾ï¼`,
            `ä½ ä»¥ã€Œæ— ç‘•ä¹‹è¯ã€æ‰¿è½½ã€Œç»ˆç„‰çš„å¯ç¤ºã€ï¼Œ`,
            `è¸è¿‡äººä¹‹å¾‹è€…æé™ï¼Œç™»ä¸´ã€Œå§‹æºå¾‹è€…ã€ç‹åº§ï¼`,
            ``,
            `ã€å§‹æºå¾‹è€…Â·çˆ±è‰å¸Œé›…ã€‘`,
            `ä¸€å¿µæ”¹å› æœï¼Œä¸€å¿µåŒ–è¯¸å¤©ï¼›å§‹æºæ—¢ç°ï¼Œä¸‡ç•Œæ— ç‘•ï¼`
        ].join('\n');
        e.reply(txt);
    }
}

async liuyingjuexing(e) {
    if (!e.isGroup) { e.reply('è¯·åœ¨ç¾¤èŠä¸­å®Œæˆæµè¤è§‰é†’'); return; }

    const usr_qq = e.user_id.toString().replace('qg_', '');
    if (!await existplayer(usr_qq)) { e.reply('ç©å®¶ä¸å­˜åœ¨'); return; }

    const player = await Read_player(usr_qq);
    if ( player.çµæ ¹.name !== 'å°‘å¥³æµè¤') {
        e.reply('åªæœ‰å°‘å¥³æµè¤çµæ ¹æ‰èƒ½å¼€å¯æµè¤è§‰é†’'); return;
    }
    if (player.ç”Ÿå‘½æœ¬æº !== 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº) {
        e.reply('ç”Ÿå‘½æœ¬æºäºç©ºï¼Œæ— æ³•æ‰¿å—è§‰é†’ä»ªå¼'); return;
    }

    /* ---------- é˜¶æ®µåˆ¤å®š ---------- */
    const isRen = player.çµæ ¹.type === 'æ˜Ÿé“';
    if (!isRen && !isShiYuan) { e.reply('å½“å‰çŠ¶æ€æ— æ³•è§‰é†’'); return; }

    /* ---------- ææ–™æ£€æŸ¥ï¼ˆä¿®æ”¹ç‚¹1ï¼šææ–™æ›´æ”¹ä¸ºæ˜Ÿæ ¸ä¸å‘½é€”ç¢ç‰‡ï¼‰ ---------- */
    const need = isRen
        ? { æ˜Ÿæ ¸: 10, å‘½é€”ç¢ç‰‡: 10, ç§˜å¢ƒæœ€ä½: 15 /*å‡†å¸*/ } // å°†åŸæœ‰ææ–™æ›¿æ¢ä¸ºæ˜Ÿæ ¸å’Œå‘½é€”ç¢ç‰‡
        : { æ˜Ÿæ ¸: 10, å‘½é€”ç¢ç‰‡: 10, ç§˜å¢ƒæœ€ä½: 19 /*ä»™ç‹å·¨å¤´*/ }; // å°†åŸæœ‰ææ–™æ›¿æ¢ä¸ºæ˜Ÿæ ¸å’Œå‘½é€”ç¢ç‰‡

    for (const [name, num] of Object.entries(need).filter(([k]) => k !== 'ç§˜å¢ƒæœ€ä½')) {
        const has = await exist_najie_thing(usr_qq, name, 'é“å…·') || 0;
        if (has < num) return e.reply(`æµè¤è§‰é†’éœ€è¦ ${num} ä¸ªã€${name}ã€‘ï¼Œå½“å‰ä»…æœ‰ ${has} ä¸ª`);
    }

    /* ---------- å¢ƒç•Œæ£€æŸ¥ ---------- */
    if (player.mijinglevel_id < need.ç§˜å¢ƒæœ€ä½) {
        return e.reply(isRen ? 'éœ€ç§˜å¢ƒä½“ç³»è¾¾åˆ°å‡†å¸æ–¹å¯æ‰¿è½½ã€Œè¨å§†ã€æœºç”²'
                            : 'éœ€ç§˜å¢ƒä½“ç³»è¾¾åˆ°ä»™ç‹å·¨å¤´æ–¹å¯å®Œå…¨è§£æ”¾ã€Œæ˜Ÿæ ¸ã€ä¹‹åŠ›');
    }

    /* ---------- æ‰£é™¤ææ–™ï¼ˆä¿®æ”¹ç‚¹2ï¼šæ‰£é™¤æ–°çš„ææ–™ï¼‰ ---------- */
    for (const [name, num] of Object.entries(need).filter(([k]) => k !== 'ç§˜å¢ƒæœ€ä½')) {
        await Add_najie_thing(usr_qq, name, 'é“å…·', -num);
    }

    /* ---------- è§‰é†’æ™‹å‡ ---------- */
    if (isRen) {
        // çµæ ¹æ›´æ–°ä¸ºæœºç”²å½¢æ€
        player.çµæ ¹ = {"id":7010015,"name":"æµè¤Â·è¨å§†æœºç”²","type":"æ˜Ÿæ ¸çŒæ‰‹","å½’ç±»":"è¯¸å¤©ä¸‡ç•Œ","eff":3,"æ³•çƒå€ç‡":3,"æ”»å‡»":3,"é˜²å¾¡":3,"ç”Ÿå‘½":3,"ç”Ÿå‘½æœ¬æº":150};
        player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
        await Write_player(usr_qq, player);

        // ä¿®æ”¹ç‚¹3ï¼šè§‰é†’æ–‡æ¡ˆé‡å†™ï¼Œè´´åˆæ˜Ÿç©¹é“é“è®¾å®š
        const txt = [
            `ğŸ”¥ ç‚½çƒˆçš„æ˜Ÿæ ¸ä¹‹å…‰åˆ’ç ´é•¿ç©ºï¼Œå‘½é€”çš„ç¢ç‰‡åœ¨æŒå¿ƒæ±‡èšï¼`,
            `ä½ å°†åæšã€æ˜Ÿæ ¸ã€‘ä¸åæšã€å‘½é€”ç¢ç‰‡ã€‘åµŒå…¥ã€Œè¨å§†ã€æœºç”²çš„æ ¸å¿ƒç‚‰å¿ƒã€‚`,
            `åºå¤§çš„èƒ½é‡ç¬é—´æ¿€æ´»äº†æ²‰ç¡çš„è£…ç”²ï¼Œæµè¤åœ¨å…‰èŠ’ä¸­å®ŒæˆåŒæ­¥ï¼ŒåŒ–èº«ä¸ºäººå½¢å¤©ç¾â€”â€”`,
            `ã€ŒæŒ‡ä»¤ç¡®è®¤ï¼Œæµè¤â…£å‹ï¼Œå®Œå…¨ç‡ƒçƒ§ï¼ã€`,
            ``,
            `ã€æ˜Ÿæ ¸çŒæ‰‹Â·æµè¤ï¼ˆè¨å§†ï¼‰ã€‘`,
            `äºæ­¤å±•ç°ï¼Œæ¯”æ˜Ÿè¾°æ›´è€€çœ¼çš„å…‰èŠ’ï¼`
        ].join('\n');
        e.reply(txt);
    }
}
async shengtijuexing(e) {
    if (!e.isGroup) {
        e.reply('ä¿®ä»™æ¸¸æˆè¯·åœ¨ç¾¤èŠä¸­æ¸¸ç©');
        return;
    }
    let usr_qq = e.user_id.toString().replace('qg_', '');
    let ifexistplay = await existplayer(usr_qq);
    if (!ifexistplay) {
        e.reply('ç©å®¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºè§’è‰²');
        return;
    }
    let game_action = await redis.get("xiuxian:player:" + usr_qq + ":game_action");
    if (game_action == 0) {
        e.reply("ä¿®ä»™ï¼šæ¸¸æˆè¿›è¡Œä¸­...");
        return;
    }
    let player = await Read_player(usr_qq);
    if (!isNotNull(player.Physique_id)) {
        e.reply("è¯·å…ˆ#åˆ·æ–°ä¿¡æ¯");
        return;
    }
    if (player.ç”Ÿå‘½æœ¬æº !== 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº) {
        e.reply("ä½ çš„ç”Ÿå‘½æœ¬æºäºç©ºæ— æ³•è§‰é†’");
        return;
    }

    // åˆå§‹åŒ–åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦ç³»ç»Ÿ
    if (typeof player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦ === 'undefined') {
        player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦ = {
            è½®æµ·: 0,
            é“å®«: 0, 
            å››æ: 0,
            åŒ–é¾™: 0
        };
    }

    // æ£€æŸ¥ç©å®¶æ˜¯å¦æ‹¥æœ‰åœ£ä½“è¡€è„‰
    if (player.çµæ ¹.type === "åœ£ä½“" && player.mijinglevel_id > 6) {
        // å°æˆåœ£ä½“è§‰é†’æ¡ä»¶ï¼šè‡³å°‘ä¸¤ä¸ªç§˜å¢ƒè¾¾åˆ°50%ä»¥ä¸Š
        const ç§˜å¢ƒå®Œæˆåº¦ = Object.values(player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦);
        const è¾¾æ ‡ç§˜å¢ƒæ•° = ç§˜å¢ƒå®Œæˆåº¦.filter(å®Œæˆåº¦ => å®Œæˆåº¦ >= 50).length;
        
        if (è¾¾æ ‡ç§˜å¢ƒæ•° >= 2) {
            player.çµæ ¹ = {
                "id": 7010012,
                "name": "å°æˆÂ·è’å¤åœ£ä½“",
                "type": "å°æˆåœ£ä½“",
                "å½’ç±»": "é®å¤©ä½é¢",
                "eff": 1.3,
                "æ³•çƒå€ç‡": 1.3,
                "æ”»å‡»": 1.6,
                "é˜²å¾¡": 2,
                "ç”Ÿå‘½": 3,
                "ç”Ÿå‘½æœ¬æº": 150
            };
            player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
            await Write_player(usr_qq, player);
            
            // æ„å»ºå°æˆåœ£ä½“è§‰é†’æ–‡æ¡ˆ
            const è§‰é†’æ–‡æ¡ˆ = [
                ` é»„é‡‘è¡€æ°”å†²éœ„æ±‰ï¼Œåœ£ä½“åˆæˆéœ‡ä¹¾å¤ï¼`,
                `ä½ å†ç»ç£¨éš¾ï¼Œå°†${è¾¾æ ‡ç§˜å¢ƒæ•°}å¤§ç§˜å¢ƒä¿®ç‚¼è‡³å°æˆå¢ƒç•Œï¼Œæ‰“ç ´å¤©é“è¯…å’’ï¼`,
                `é»„é‡‘åœ£è¡€ç»ˆäºè§‰é†’ï¼Œè‹¦æµ·åŒ–é‡‘æ´‹ï¼Œå¼‚è±¡åˆæ˜¾å¨ï¼Œè‡ªæ­¤å¯ä»¥æ­£å¸¸ä¿®è¡Œï¼`,
                ``,
                `ã€åœ£ä½“å°æˆã€‘`,
                `è½®æµ·ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ·}%`,
                `é“å®«ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®«}%`, 
                `å››æç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ}%`,
                `åŒ–é¾™ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™}%`,
                ``,
                ` åœ£ä½“å¼‚è±¡å·²å¯åˆæ­¥æ–½å±•ï¼ŒåŒé˜¶æ— æ•Œä¹‹è·¯å¼€å¯ï¼`
            ];
            
            e.reply(è§‰é†’æ–‡æ¡ˆ.join('\n'));
        } else {
            // ç§˜å¢ƒä¿®ç‚¼ä¸è¶³çš„æç¤º
            const ä¸è¶³æ–‡æ¡ˆ = [
                ` åœ£ä½“è§‰é†’æ¡ä»¶ä¸è¶³ï¼`,
                `éœ€è‡³å°‘å°†ä¸¤å¤§ç§˜å¢ƒä¿®ç‚¼è‡³50%ä»¥ä¸Šæ–¹å¯å°æˆ`,
                `å½“å‰ç§˜å¢ƒå®Œæˆåº¦ï¼š`,
                `è½®æµ·ï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ·}% | é“å®«ï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®«}%`,
                `å››æï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ}% | åŒ–é¾™ï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™}%`,
                ``,
                ` æç¤ºï¼šä½¿ç”¨ #ä¿®ç‚¼åœ£ä½“ç§˜æœ¯ æŒ‡ä»¤ç»§ç»­æ‰“ç£¨ç§˜å¢ƒ`
            ];
            e.reply(ä¸è¶³æ–‡æ¡ˆ.join('\n'));
        }
    } 
    else if (player.çµæ ¹.type === "å°æˆåœ£ä½“" && player.mijinglevel_id > 14) {
        // å¤§æˆåœ£ä½“è§‰é†’æ¡ä»¶ï¼šå››å¤§ç§˜å¢ƒå¿…é¡»å…¨éƒ¨è¾¾åˆ°100%åœ†æ»¡[6](@ref)
        const ç§˜å¢ƒå®Œæˆåº¦ = Object.values(player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦);
        const æ˜¯å¦å…¨éƒ¨åœ†æ»¡ = ç§˜å¢ƒå®Œæˆåº¦.every(å®Œæˆåº¦ => å®Œæˆåº¦ >= 100);
        
        if (æ˜¯å¦å…¨éƒ¨åœ†æ»¡) {
            player.çµæ ¹ = {
                "id": 7010013,
                "name": "å¤§æˆÂ·è’å¤åœ£ä½“", 
                "type": "å¤§æˆåœ£ä½“",
                "å½’ç±»": "é®å¤©ä½é¢",
                "eff": 1.8,
                "æ³•çƒå€ç‡": 1.8,
                "æ”»å‡»": 4,
                "é˜²å¾¡": 5,
                "ç”Ÿå‘½": 6,
                "ç”Ÿå‘½æœ¬æº": 300
            };
            player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
            await Write_player(usr_qq, player);
            
            // æ„å»ºå¤§æˆåœ£ä½“è§‰é†’æ–‡æ¡ˆï¼ˆè¾°ä¸œé£æ ¼ï¼‰
            const å¤§æˆæ–‡æ¡ˆ = [
                ` é»„é‡‘è¡€æ°”è´¯ä¹éœ„ï¼Œåœ£ä½“å¤§æˆéœ‡å¤ä»Šï¼`,
                `è½®æµ·ã€é“å®«ã€å››æã€åŒ–é¾™å››å¤§ç§˜å¢ƒå°½æ•°åœ†æ»¡ï¼Œ`,
                `ä½ ç»ˆäºæ‰“ç ´å¤©åœ°æ¡æ¢ï¼Œæˆå°±æ— ä¸Šå¤§æˆåœ£ä½“ï¼`,
                ``,
                `ã€åœ£ä½“å¤§æˆÂ·å¯ä¸å¤§å¸äº‰é”‹ã€‘`,
                `é»„é‡‘è¡€æ°”å¦‚æµ·ï¼Œä¸¾æ‰‹æŠ•è¶³é—´æ˜Ÿè¾°æ‘‡æ›³ï¼Œ`,
                `å·²ç„¶æ‹¥æœ‰å«æ¿å¤ä¹‹å¤§å¸çš„ç»ä¸–æˆ˜åŠ›ï¼`,
                ``,
                ` ç§˜å¢ƒåœ†æ»¡çŠ¶æ€ï¼š`,
                `è½®æµ·ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ·}% `,
                `é“å®«ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®«}% `,
                `å››æç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ}% `, 
                `åŒ–é¾™ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™}% `,
                ``,
                ` ä»æ­¤å¯é•‡å‹é»‘æš—åŠ¨ä¹±ï¼ŒæŠ¤ä½‘äººæ—ä¸‡å¹´å¤ªå¹³ï¼`
            ];
            
            e.reply(å¤§æˆæ–‡æ¡ˆ.join('\n'));
        } else {
            // å¤§æˆæ¡ä»¶ä¸è¶³çš„è¯¦ç»†æç¤º
            const æœªåœ†æ»¡ç§˜å¢ƒ = [];
            if (player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ· < 100) æœªåœ†æ»¡ç§˜å¢ƒ.push(`è½®æµ·(${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ·}%)`);
            if (player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®« < 100) æœªåœ†æ»¡ç§˜å¢ƒ.push(`é“å®«(${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®«}%)`);
            if (player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ < 100) æœªåœ†æ»¡ç§˜å¢ƒ.push(`å››æ(${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ}%)`);
            if (player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™ < 100) æœªåœ†æ»¡ç§˜å¢ƒ.push(`åŒ–é¾™(${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™}%)`);
            
            const ä¸è¶³æ–‡æ¡ˆ = [
                ` å¤§æˆåœ£ä½“è§‰é†’æ¡ä»¶ä¸è¶³ï¼`,
                `éœ€å°†å››å¤§ç§˜å¢ƒå…¨éƒ¨ä¿®ç‚¼è‡³100%åœ†æ»¡å¢ƒç•Œ`,
                ``,
                ` å½“å‰è¿›åº¦ï¼š`,
                `è½®æµ·ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ·}% ${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.è½®æµ· >= 100 ? 'ğŸŒŸ' : 'âŒ'}`,
                `é“å®«ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®«}% ${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.é“å®« >= 100 ? 'ğŸŒŸ' : 'âŒ'}`,
                `å››æç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ}% ${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.å››æ >= 100 ? 'ğŸŒŸ' : 'âŒ'}`,
                `åŒ–é¾™ç§˜å¢ƒï¼š${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™}% ${player.åœ£ä½“ç§˜å¢ƒå®Œæˆåº¦.åŒ–é¾™ >= 100 ? 'ğŸŒŸ' : 'âŒ'}`,
                ``,
                ` æœªåœ†æ»¡ç§˜å¢ƒï¼š${æœªåœ†æ»¡ç§˜å¢ƒ.join('ã€')}`,
                `ç»§ç»­ä½¿ç”¨ #ä¿®ç‚¼åœ£ä½“ç§˜æœ¯ æŒ‡ä»¤æ‰“ç£¨ç§˜å¢ƒ`
            ];
            
            e.reply(ä¸è¶³æ–‡æ¡ˆ.join('\n'));
        }
    } 
    else if (!["åœ£ä½“", "å°æˆåœ£ä½“"].includes(player.çµæ ¹.type)) {
        e.reply(` è¡€è„‰ä¸ç¬¦ï¼éåœ£ä½“ä¸€è„‰ï¼Œæ— æ³•è§‰é†’åœ£ä½“ä¹‹å¨ã€‚`);
    } 
    else {
        e.reply(` è§‰é†’æ¡ä»¶ä¸è¶³ï¼éœ€è¾¾åˆ°æ›´é«˜å¢ƒç•Œä¸”å®Œæˆç§˜å¢ƒä¿®ç‚¼ã€‚`);
    }
}
async batijuexing(e) {
    if (!e.isGroup) {
        e.reply('ä¿®ä»™æ¸¸æˆè¯·åœ¨ç¾¤èŠä¸­æ¸¸ç©');
        return;
    }
    let usr_qq = e.user_id.toString().replace('qg_', '');
    let ifexistplay = await existplayer(usr_qq);
    if (!ifexistplay) {
        e.reply('ç©å®¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºè§’è‰²');
        return;
    }
    let game_action = await redis.get("xiuxian:player:" + usr_qq + ":game_action");
    if (game_action == 0) {
        e.reply("ä¿®ä»™ï¼šæ¸¸æˆè¿›è¡Œä¸­...");
        return;
    }
    let player = await Read_player(usr_qq);
    if (!isNotNull(player.Physique_id)) {
        e.reply("è¯·å…ˆ#åˆ·æ–°ä¿¡æ¯");
        return;
    }
    if (player.ç”Ÿå‘½æœ¬æº !== 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº) {
        e.reply("ä½ çš„ç”Ÿå‘½æœ¬æºäºç©ºæ— æ³•è§‰é†’");
        return;
    }

    // æ£€æŸ¥ç©å®¶æ˜¯å¦æ‹¥æœ‰éœ¸ä½“è¡€è„‰
    if (player.çµæ ¹.type === "éœ¸ä½“" && player.mijinglevel_id > 6) {
        let éœ¸è¡€ = await exist_najie_thing(usr_qq, 'ä¸ç­éœ¸è¡€', 'é“å…·')    
        if (éœ¸è¡€) {
            // ç§»é™¤ä¸ç­éœ¸è¡€
            await Add_najie_thing(usr_qq, "ä¸ç­éœ¸è¡€", "é“å…·", -1);
            
            // æ›´æ–°ä¸ºå°æˆéœ¸ä½“
            player.çµæ ¹ = {
                "id": 70046,
                "name": "å°æˆÂ·è‹å¤©éœ¸ä½“",
                "type": "å°æˆéœ¸ä½“",
                "å½’ç±»": "é®å¤©ä½é¢",
                "eff": 30,
                "æ³•çƒå€ç‡": 1.5,
                "æ”»å‡»": 2.5,
                "é˜²å¾¡": 1,
                "ç”Ÿå‘½": 1,
                "ç”Ÿå‘½æœ¬æº": 100
            };
            player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
            await Write_player(usr_qq, player);
            
            // æ„å»ºå°æˆéœ¸ä½“è§‰é†’æ–‡æ¡ˆ
            const è§‰é†’æ–‡æ¡ˆ = [
                ` ç´«è‰²è¡€æ°”å†²éœ„æ±‰ï¼Œéœ¸ä½“åˆæˆéœ‡ä¹¾å¤ï¼`,
                `ä½ èåˆä¸ç­éœ¸è¡€ï¼Œæ¿€å‘ä½“å†…éœ¸ä½“è¡€è„‰ï¼Œ`,
                `ç´«è‰²éœ¸è¡€æ²¸è…¾å¦‚æµ·ï¼Œè‹¦æµ·åŒ–ç´«æ´‹ï¼Œå¼‚è±¡åˆæ˜¾å¨ï¼`,
                ``,
                `ã€éœ¸ä½“å°æˆã€‘`,
                `è‹å¤©éœ¸ä½“è¡€è„‰åˆæ­¥è§‰é†’ï¼ŒåŒé˜¶æ— æ•Œä¹‹è·¯å¼€å¯ï¼`,
                `ç´«è‰²è¡€æ°”è´¯ä¹éœ„ï¼Œéœ¸æ‹³ä¸€å‡ºå±±æ²³ç¢ï¼`,
                ``,
                ` ä»æ­¤å¯åŠ›å‹åŒä»£å¤©éª„ï¼Œå‚²è§†ç¾¤é›„ï¼`
            ];
            
            e.reply(è§‰é†’æ–‡æ¡ˆ.join('\n'));
        } else {
            e.reply('ä½ æ²¡æœ‰ä¸ç­éœ¸è¡€æ— æ³•è¿›è¡Œè§‰é†’');
        }
    } 
    else if (player.çµæ ¹.type === "å°æˆéœ¸ä½“" && player.mijinglevel_id > 14) {
            // æ£€æŸ¥éœ¸ä½“å¤§åœ†æ»¡æ ‡å¿—
            if (player.å­¦ä¹ çš„åŠŸæ³•?.includes("éœ¸æ‹³çœŸè§£")&&player.éœ¸ä½“ç¥–æ˜Ÿæ´—ç¤¼) {
                player.çµæ ¹ = {
                    "id": 7010013,
                    "name": "å¤§æˆÂ·è‹å¤©éœ¸ä½“", 
                    "type": "å¤§æˆéœ¸ä½“",
                    "å½’ç±»": "é®å¤©ä½é¢",
                    "eff": 100,
                    "æ³•çƒå€ç‡": 2,
                    "æ”»å‡»": 5,
                    "é˜²å¾¡": 3,
                    "ç”Ÿå‘½": 3,
                    "ç”Ÿå‘½æœ¬æº": 150
                };
                player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
                await Write_player(usr_qq, player);
                
                // æ„å»ºå¤§æˆéœ¸ä½“è§‰é†’æ–‡æ¡ˆ
                const å¤§æˆæ–‡æ¡ˆ = [
                    ` ç´«è‰²è¡€æ°”è´¯ä¹éœ„ï¼Œéœ¸ä½“å¤§æˆéœ‡å¤ä»Šï¼`,
                    `å‡†å¸ä¹é‡å¤©å·…å³°ï¼Œéœ¸è¡€æ²¸è…¾å¦‚æ˜Ÿæ²³å€’å·ï¼`,
                    `ä½ ç»ˆäºå°†è‹å¤©éœ¸ä½“æ·¬ç‚¼è‡³å¤§åœ†æ»¡å¢ƒç•Œï¼`,
                    ``,
                    `ã€éœ¸ä½“å¤§æˆÂ·å¯ä¸å¤§å¸äº‰é”‹ã€‘`,
                    `ç´«è‰²è¡€æ°”å¦‚æµ·ï¼Œä¸¾æ‰‹æŠ•è¶³é—´æ˜Ÿè¾°æ‘‡æ›³ï¼Œ`,
                    `éœ¸æ‹³ä¸€å‡ºï¼Œæ˜Ÿæ²³å´©ç¢ï¼Œä¸‡é“å“€é¸£ï¼`,
                    `å·²ç„¶æ‹¥æœ‰å«æ¿å¤ä¹‹å¤§å¸çš„ç»ä¸–æˆ˜åŠ›ï¼`,
                    ``,
                    ` ä»æ­¤å¯é•‡å‹ä¸€æ–¹æ˜ŸåŸŸï¼Œéœ¸ç»ä¹å¤©ååœ°ï¼`
                ];
                
                e.reply(å¤§æˆæ–‡æ¡ˆ.join('\n'));
            } else {
                // éœ¸ä½“æœªå¤§åœ†æ»¡æç¤º
                const ä¸è¶³æ–‡æ¡ˆ = [
                    ` å°æˆéœ¸ä½“å°šæœªå¤§åœ†æ»¡ï¼`,
                    `éœ€å°†éœ¸ä½“è¡€è„‰æ·¬ç‚¼è‡³æè‡´å¢ƒç•Œ`,
                    ``,
                    `é¡»ï¼š`,
                    `1. å‰å¾€éœ¸ä½“ç¥–æ˜Ÿæ¥å—ç¥–æ± æ´—ç¤¼`,
                    `2. ä¿®ç‚¼éœ¸æ‹³çœŸè§£`,
                    `3. è¾¾åˆ°å‡†å¸ä¹é‡å¤©`
                ];
                
                e.reply(ä¸è¶³æ–‡æ¡ˆ.join('\n'));
            }
        }
    else if (!["éœ¸ä½“", "å°æˆéœ¸ä½“"].includes(player.çµæ ¹.type)) {
        e.reply(` è¡€è„‰ä¸ç¬¦ï¼ééœ¸ä½“ä¸€è„‰ï¼Œæ— æ³•è§‰é†’éœ¸ä½“ä¹‹å¨ã€‚`);
    } 
    else {
        e.reply(` è§‰é†’æ¡ä»¶ä¸è¶³ï¼éœ€è¾¾åˆ°æ›´é«˜å¢ƒç•Œã€‚`);
    }
}
async yaotijuexing(e) {
    if (!e.isGroup) {
        e.reply('ä¿®ä»™æ¸¸æˆè¯·åœ¨ç¾¤èŠä¸­æ¸¸ç©');
        return;
    }
    let usr_qq = e.user_id.toString().replace('qg_', '');
    let ifexistplay = await existplayer(usr_qq);
    if (!ifexistplay) {
        e.reply('ç©å®¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºè§’è‰²');
        return;
    }
    let game_action = await redis.get("xiuxian:player:" + usr_qq + ":game_action");
    if (game_action == 0) {
        e.reply("ä¿®ä»™ï¼šæ¸¸æˆè¿›è¡Œä¸­...");
        return;
    }
    let player = await Read_player(usr_qq);
    if (!isNotNull(player.Physique_id)) {
        e.reply("è¯·å…ˆ#åˆ·æ–°ä¿¡æ¯");
        return;
    }
    if (player.ç”Ÿå‘½æœ¬æº !== 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº) {
        e.reply("ä½ çš„ç”Ÿå‘½æœ¬æºäºç©ºæ— æ³•è§‰é†’");
        return;
    }

    // å°æˆå¦–ä½“è§‰é†’
    if (player.çµæ ¹.type === "å¦–ä½“" && player.mijinglevel_id > 6) {
        let å¤©å¦–çœŸè¡€ = await exist_najie_thing(usr_qq, 'å¤©å¦–çœŸè¡€', 'é“å…·');
        if (å¤©å¦–çœŸè¡€) {
            // ç§»é™¤å¤©å¦–çœŸè¡€
            await Add_najie_thing(usr_qq, "å¤©å¦–çœŸè¡€", "é“å…·", -1);
            
            // æ›´æ–°ä¸ºå°æˆå¦–ä½“
            player.çµæ ¹ = {
                "id": 7010018,
                "name": "å¤©å¦–ç‹ä½“",
                "type": "å°æˆå¦–ä½“",
                "å½’ç±»": "é®å¤©ä½é¢",
                "eff": 2.2,
                "æ³•çƒå€ç‡": 1.4,
                "æ”»å‡»": 1.8,
                "é˜²å¾¡": 0.8,
                "ç”Ÿå‘½": 1.5,
                "ç”Ÿå‘½æœ¬æº": 50
            };
            player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
            await Write_player(usr_qq, player);
            
            // æ„å»ºå°æˆå¦–ä½“è§‰é†’æ–‡æ¡ˆ
            const è§‰é†’æ–‡æ¡ˆ = [
                ` å¦–æ°”å†²å¤©è´¯ä¹éœ„ï¼Œä¸‡å¦–æœæ‹œéœ‡æ˜Ÿæ²³ï¼`,
                `ä½ ç‚¼åŒ–å¤©å¦–çœŸè¡€ï¼Œä½“å†…å¦–è¡€æ²¸è…¾å¦‚æµ·ï¼Œèº«åæµ®ç°ä¹å¤§å¦–ç¥è™šå½±ï¼`,
                `é’é¸¾å±•ç¿…ï¼Œç™½è™å•¸å¤©ï¼Œç„æ­¦é•‡æµ·ï¼Œæœ±é›€ç„šç©º...`,
                `ä¸‡å¦–é½é¸£ï¼Œæ­è¿æ–°ç‹è¯ç”Ÿï¼`,
                ``,
                `ã€å¤©å¦–ç‹ä½“è§‰é†’ã€‘`,
                `å¦–è¡€è¿”ç¥–ï¼Œèœ•å˜ä¸ºå¤©å¦–ç‹ä½“ï¼`,
                `ä¸¾æ‰‹æŠ•è¶³é—´å¼•åŠ¨ä¸‡å¦–ä¹‹åŠ›ï¼Œå¦–çš‡è¡€è„‰åˆæ­¥è§‰é†’ï¼`,
                ``,
                ` ä»æ­¤å¯ç»Ÿå¾¡ä¸‡å¦–ï¼Œå·ä»¤ç¾¤å¦–ï¼Œè¸ä¸Šå¦–çš‡ä¹‹è·¯ï¼`
            ];
            
            e.reply(è§‰é†’æ–‡æ¡ˆ.join('\n'));
        } else {
            e.reply('ä½ æ²¡æœ‰å¤©å¦–çœŸè¡€æ— æ³•è¿›è¡Œè§‰é†’');
        }
    } 
    // å¤§æˆå¦–ä½“è§‰é†’
    else if (player.çµæ ¹.type === "å°æˆå¦–ä½“" && player.mijinglevel_id > 14) {
        // æ£€æŸ¥å¤§æˆæ¡ä»¶
        const hasEmperorScripture = player.å­¦ä¹ çš„åŠŸæ³•?.includes("å¦–å¸å¤ç»");
        
        if (hasEmperorScripture ) {
            // æ›´æ–°ä¸ºå¤§æˆå¦–ä½“
            player.çµæ ¹ = {
                "id": 7010019,
                "name": "å¤©å¦–çš‡ä½“",
                "type": "å¤§æˆå¦–ä½“",
                "å½’ç±»": "é®å¤©ä½é¢",
                "eff": 4.0,
                "æ³•çƒå€ç‡": 2.2,
                "æ”»å‡»": 3.5,
                "é˜²å¾¡": 1.5,
                "ç”Ÿå‘½": 3.0,
                "ç”Ÿå‘½æœ¬æº": 100
            };
            player.ç”Ÿå‘½æœ¬æº = 100 + player.çµæ ¹.ç”Ÿå‘½æœ¬æº;
            await Write_player(usr_qq, player);
            
            // æ„å»ºå¤§æˆå¦–ä½“è§‰é†’æ–‡æ¡ˆ
            const å¤§æˆæ–‡æ¡ˆ = [
                ` å¦–çš‡ä¸´ä¸–ï¼Œä¸‡ç•Œéœ‡é¢¤ï¼`,
                `ä½ èåˆå¦–çš‡ä¹‹å¿ƒä¸å¤ªå¤å¦–è¡€ï¼Œèº«åæµ®ç°å¦–å¸è™šå½±ï¼`,
                `é’å¸è¸ç©ºè€Œæ¥ï¼Œä¸€æŒ‡æ´ç©¿æ—¶ç©ºï¼Œå°†æ— ä¸Šå¦–çš‡ä¼ æ‰¿æ‰“å…¥ä½ çš„ä»™å°ï¼`,
                ``,
                `ã€å¤©å¦–çš‡ä½“å¤§æˆã€‘`,
                `å¦–è¡€å½»åº•è¿”ç¥–ï¼Œèœ•å˜ä¸ºå¤©å¦–çš‡ä½“ï¼`,
                `å‘¨èº«å¦–æ°”åŒ–ä½œä¹æ¡çœŸé¾™ï¼Œç¯ç»•é£èˆï¼Œä¸‡å¦–è‡£æœï¼`,
                `"å¾é“ä¸å­¤..."é’å¸è™šå½±å«ç¬‘æ¶ˆæ•£ï¼ŒåŒ–ä½œç‚¹ç‚¹é’å…‰èå…¥ä½ çš„è¡€è„‰ã€‚`,
                ``,
                ` ä»æ­¤å¯ç»Ÿå¾¡è¯¸å¤©ä¸‡å¦–ï¼Œé‡ç°ä¸Šå¤å¦–åº­è¾‰ç…Œï¼`
            ];
            
            e.reply(å¤§æˆæ–‡æ¡ˆ.join('\n'));
        } else {
            // æ¡ä»¶ä¸è¶³æç¤º
            const ä¸è¶³æ–‡æ¡ˆ = [` å¤©å¦–çš‡ä½“è§‰é†’æ¡ä»¶ä¸è¶³ï¼š`];
            
            if (!hasEmperorScripture) {
                ä¸è¶³æ–‡æ¡ˆ.push(`- éœ€é¢†æ‚Ÿã€Œå¦–å¸å¤ç»ã€æ— ä¸Šå¦™æ³•`);
            }
            
            ä¸è¶³æ–‡æ¡ˆ.push(``);
            ä¸è¶³æ–‡æ¡ˆ.push(` ç»§ç»­è¿½å¯»å¦–çš‡ä¹‹è·¯ï¼Œç»ˆå°†é‡ç°ä¸Šå¤å¦–åº­è¾‰ç…Œï¼`);
            
            e.reply(ä¸è¶³æ–‡æ¡ˆ.join('\n'));
        }
    } 
    else if (!["å¦–ä½“", "å°æˆå¦–ä½“"].includes(player.çµæ ¹.type)) {
        e.reply(` è¡€è„‰ä¸ç¬¦ï¼éå¦–ä½“ä¸€è„‰ï¼Œæ— æ³•è§‰é†’å¦–çš‡ä¹‹å¨ã€‚`);
    } 
    else {
        e.reply(` è§‰é†’æ¡ä»¶ä¸è¶³ï¼éœ€è¾¾åˆ°æ›´é«˜å¢ƒç•Œã€‚`);
    }
}

}